{"ast":null,"code":"'use strict';\n\nconst qs = require('querystring');\n\nconst URL = require('node-url-utils');\n\nconst Normalizer = require('../../normalizer.js');\n\nclass DefaultNormalizer extends Normalizer {\n  constructor(options) {\n    super(options);\n    this.globalOptions = options || {};\n  }\n  /*\n   * Generate method + full uri + body string.\n   * - req, Object\n   * - [options], Object\n   */\n\n\n  normalize(req, options) {\n    options = options || {};\n\n    if (!URL.parse(req.uri).search && req.qs) {\n      req.uri = [req.uri, qs.stringify(req.qs)].join('?');\n    }\n\n    if (req.method === 'POST') {\n      if (req.json && typeof req.body === 'object') {\n        //only support one level Object\n        const sorted = Object.keys(req.body).map(k => [k, req.body[k]]).sort(function (a, b) {\n          return a[0] === b[0] ? a[1] > b[1] : a[0] > b[0];\n        }).reduce(function (pre, cur) {\n          pre[cur[0]] = cur[1];\n          return pre;\n        }, Object.create(null));\n        req.body = JSON.stringify(sorted);\n      } else if (typeof req.form === 'object') {\n        req.body = Object.keys(req.form).map(function (k) {\n          return [k, req.form[k]].join('=');\n        }).sort().join('&');\n      } else if (typeof req.form === 'string') {\n        req.body = req.form.split('&').sort().join('&');\n      }\n    }\n\n    const opts = Object.assign({}, this.globalOptions, options);\n\n    if (opts.stripFragment !== false) {\n      req.uri = req.uri.replace(/#.*/g, '');\n    }\n\n    return req;\n  }\n\n}\n\nmodule.exports = DefaultNormalizer;","map":{"version":3,"sources":["/Users/marshoward/Development/code/river/frontend/app/node_modules/seenreq/lib/normalizer/default.js"],"names":["qs","require","URL","Normalizer","DefaultNormalizer","constructor","options","globalOptions","normalize","req","parse","uri","search","stringify","join","method","json","body","sorted","Object","keys","map","k","sort","a","b","reduce","pre","cur","create","JSON","form","split","opts","assign","stripFragment","replace","module","exports"],"mappings":"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","sourcesContent":["\n'use strict';\n\nconst qs = require('querystring');\nconst URL = require('node-url-utils');\nconst Normalizer = require('../../normalizer.js');\n\nclass DefaultNormalizer extends Normalizer{\n\tconstructor(options){\n\t\tsuper(options);\n\t\tthis.globalOptions = options || {};\n\t}\n\n\t/*\n\t * Generate method + full uri + body string.\n\t * - req, Object\n\t * - [options], Object\n\t */\n\t\n\tnormalize(req, options) {\n\t\toptions = options || {};\n\n\t\tif (!URL.parse(req.uri).search && req.qs) {\n\t\t\treq.uri = [req.uri, qs.stringify(req.qs) ].join('?');\n\t\t}\n\n\t\tif (req.method === 'POST') {\n\t\t\tif (req.json && typeof req.body === 'object') { //only support one level Object\n\t\t\t\tconst sorted = Object.keys(req.body).map(k => [k, req.body[k]]).sort(function(a, b) {\n\t\t\t\t\treturn a[0] === b[0] ? a[1] > b[1] : a[0] > b[0];\n\t\t\t\t}).reduce(function(pre, cur) {\n\t\t\t\t\tpre[cur[0]] = cur[1];\n\t\t\t\t\treturn pre;\n\t\t\t\t}, Object.create(null));\n\t\t\t\treq.body = JSON.stringify(sorted);\n\t\t\t} else if (typeof req.form === 'object') {\n\t\t\t\treq.body = Object.keys(req.form).map(function(k) {\n\t\t\t\t\treturn [k, req.form[k]].join('=');\n\t\t\t\t}).sort().join('&');\n\t\t\t} else if (typeof req.form === 'string') {\n\t\t\t\treq.body = req.form.split('&').sort().join('&');\n\t\t\t}\n\t\t}\n\t\t\n\t\tconst opts = Object.assign({},this.globalOptions, options);\n\t\tif (opts.stripFragment !== false) {\n\t\t\treq.uri = req.uri.replace(/#.*/g, '');\n\t\t}\n\t\t\n\t\treturn req;\n\t}\n}\n\nmodule.exports = DefaultNormalizer;\n"]},"metadata":{},"sourceType":"script"}