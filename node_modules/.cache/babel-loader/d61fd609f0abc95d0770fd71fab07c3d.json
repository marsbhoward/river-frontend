{"ast":null,"code":"/**\n * Copyright 2017 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst fs = require('fs');\n\nconst EventEmitter = require('events');\n\nconst mime = require('mime');\n\nconst {\n  Events\n} = require('./Events');\n\nconst {\n  Connection\n} = require('./Connection');\n\nconst {\n  Dialog\n} = require('./Dialog');\n\nconst {\n  EmulationManager\n} = require('./EmulationManager');\n\nconst {\n  FrameManager\n} = require('./FrameManager');\n\nconst {\n  Keyboard,\n  Mouse,\n  Touchscreen\n} = require('./Input');\n\nconst Tracing = require('./Tracing');\n\nconst {\n  helper,\n  debugError,\n  assert\n} = require('./helper');\n\nconst {\n  Coverage\n} = require('./Coverage');\n\nconst {\n  Worker\n} = require('./Worker');\n\nconst {\n  createJSHandle\n} = require('./JSHandle');\n\nconst {\n  Accessibility\n} = require('./Accessibility');\n\nconst {\n  TimeoutSettings\n} = require('./TimeoutSettings');\n\nconst writeFileAsync = helper.promisify(fs.writeFile);\n\nclass Page extends EventEmitter {\n  /**\n   * @param {!Puppeteer.CDPSession} client\n   * @param {!Puppeteer.Target} target\n   * @param {boolean} ignoreHTTPSErrors\n   * @param {?Puppeteer.Viewport} defaultViewport\n   * @param {!Puppeteer.TaskQueue} screenshotTaskQueue\n   * @return {!Promise<!Page>}\n   */\n  static async create(client, target, ignoreHTTPSErrors, defaultViewport, screenshotTaskQueue) {\n    const page = new Page(client, target, ignoreHTTPSErrors, screenshotTaskQueue);\n    await page._initialize();\n    if (defaultViewport) await page.setViewport(defaultViewport);\n    return page;\n  }\n  /**\n   * @param {!Puppeteer.CDPSession} client\n   * @param {!Puppeteer.Target} target\n   * @param {boolean} ignoreHTTPSErrors\n   * @param {!Puppeteer.TaskQueue} screenshotTaskQueue\n   */\n\n\n  constructor(client, target, ignoreHTTPSErrors, screenshotTaskQueue) {\n    super();\n    this._closed = false;\n    this._client = client;\n    this._target = target;\n    this._keyboard = new Keyboard(client);\n    this._mouse = new Mouse(client, this._keyboard);\n    this._timeoutSettings = new TimeoutSettings();\n    this._touchscreen = new Touchscreen(client, this._keyboard);\n    this._accessibility = new Accessibility(client);\n    /** @type {!FrameManager} */\n\n    this._frameManager = new FrameManager(client, this, ignoreHTTPSErrors, this._timeoutSettings);\n    this._emulationManager = new EmulationManager(client);\n    this._tracing = new Tracing(client);\n    /** @type {!Map<string, Function>} */\n\n    this._pageBindings = new Map();\n    this._coverage = new Coverage(client);\n    this._javascriptEnabled = true;\n    /** @type {?Puppeteer.Viewport} */\n\n    this._viewport = null;\n    this._screenshotTaskQueue = screenshotTaskQueue;\n    /** @type {!Map<string, Worker>} */\n\n    this._workers = new Map();\n    client.on('Target.attachedToTarget', event => {\n      if (event.targetInfo.type !== 'worker') {\n        // If we don't detach from service workers, they will never die.\n        client.send('Target.detachFromTarget', {\n          sessionId: event.sessionId\n        }).catch(debugError);\n        return;\n      }\n\n      const session = Connection.fromSession(client).session(event.sessionId);\n      const worker = new Worker(session, event.targetInfo.url, this._addConsoleMessage.bind(this), this._handleException.bind(this));\n\n      this._workers.set(event.sessionId, worker);\n\n      this.emit(Events.Page.WorkerCreated, worker);\n    });\n    client.on('Target.detachedFromTarget', event => {\n      const worker = this._workers.get(event.sessionId);\n\n      if (!worker) return;\n      this.emit(Events.Page.WorkerDestroyed, worker);\n\n      this._workers.delete(event.sessionId);\n    });\n\n    this._frameManager.on(Events.FrameManager.FrameAttached, event => this.emit(Events.Page.FrameAttached, event));\n\n    this._frameManager.on(Events.FrameManager.FrameDetached, event => this.emit(Events.Page.FrameDetached, event));\n\n    this._frameManager.on(Events.FrameManager.FrameNavigated, event => this.emit(Events.Page.FrameNavigated, event));\n\n    const networkManager = this._frameManager.networkManager();\n\n    networkManager.on(Events.NetworkManager.Request, event => this.emit(Events.Page.Request, event));\n    networkManager.on(Events.NetworkManager.Response, event => this.emit(Events.Page.Response, event));\n    networkManager.on(Events.NetworkManager.RequestFailed, event => this.emit(Events.Page.RequestFailed, event));\n    networkManager.on(Events.NetworkManager.RequestFinished, event => this.emit(Events.Page.RequestFinished, event));\n    this._fileChooserInterceptors = new Set();\n    client.on('Page.domContentEventFired', event => this.emit(Events.Page.DOMContentLoaded));\n    client.on('Page.loadEventFired', event => this.emit(Events.Page.Load));\n    client.on('Runtime.consoleAPICalled', event => this._onConsoleAPI(event));\n    client.on('Runtime.bindingCalled', event => this._onBindingCalled(event));\n    client.on('Page.javascriptDialogOpening', event => this._onDialog(event));\n    client.on('Runtime.exceptionThrown', exception => this._handleException(exception.exceptionDetails));\n    client.on('Inspector.targetCrashed', event => this._onTargetCrashed());\n    client.on('Performance.metrics', event => this._emitMetrics(event));\n    client.on('Log.entryAdded', event => this._onLogEntryAdded(event));\n    client.on('Page.fileChooserOpened', event => this._onFileChooser(event));\n\n    this._target._isClosedPromise.then(() => {\n      this.emit(Events.Page.Close);\n      this._closed = true;\n    });\n  }\n\n  async _initialize() {\n    await Promise.all([this._frameManager.initialize(), this._client.send('Target.setAutoAttach', {\n      autoAttach: true,\n      waitForDebuggerOnStart: false,\n      flatten: true\n    }), this._client.send('Performance.enable', {}), this._client.send('Log.enable', {})]);\n  }\n  /**\n   * @param {!Protocol.Page.fileChooserOpenedPayload} event\n   */\n\n\n  async _onFileChooser(event) {\n    if (!this._fileChooserInterceptors.size) return;\n\n    const frame = this._frameManager.frame(event.frameId);\n\n    const context = await frame.executionContext();\n    const element = await context._adoptBackendNodeId(event.backendNodeId);\n    const interceptors = Array.from(this._fileChooserInterceptors);\n\n    this._fileChooserInterceptors.clear();\n\n    const fileChooser = new FileChooser(this._client, element, event);\n\n    for (const interceptor of interceptors) interceptor.call(null, fileChooser);\n  }\n  /**\n   * @param {!{timeout?: number}=} options\n   * @return !Promise<!FileChooser>}\n   */\n\n\n  async waitForFileChooser(options = {}) {\n    if (!this._fileChooserInterceptors.size) await this._client.send('Page.setInterceptFileChooserDialog', {\n      enabled: true\n    });\n    const {\n      timeout = this._timeoutSettings.timeout()\n    } = options;\n    let callback;\n    const promise = new Promise(x => callback = x);\n\n    this._fileChooserInterceptors.add(callback);\n\n    return helper.waitWithTimeout(promise, 'waiting for file chooser', timeout).catch(e => {\n      this._fileChooserInterceptors.delete(callback);\n\n      throw e;\n    });\n  }\n  /**\n   * @param {!{longitude: number, latitude: number, accuracy: (number|undefined)}} options\n   */\n\n\n  async setGeolocation(options) {\n    const {\n      longitude,\n      latitude,\n      accuracy = 0\n    } = options;\n    if (longitude < -180 || longitude > 180) throw new Error(`Invalid longitude \"${longitude}\": precondition -180 <= LONGITUDE <= 180 failed.`);\n    if (latitude < -90 || latitude > 90) throw new Error(`Invalid latitude \"${latitude}\": precondition -90 <= LATITUDE <= 90 failed.`);\n    if (accuracy < 0) throw new Error(`Invalid accuracy \"${accuracy}\": precondition 0 <= ACCURACY failed.`);\n    await this._client.send('Emulation.setGeolocationOverride', {\n      longitude,\n      latitude,\n      accuracy\n    });\n  }\n  /**\n   * @return {!Puppeteer.Target}\n   */\n\n\n  target() {\n    return this._target;\n  }\n  /**\n   * @return {!Puppeteer.Browser}\n   */\n\n\n  browser() {\n    return this._target.browser();\n  }\n  /**\n   * @return {!Puppeteer.BrowserContext}\n   */\n\n\n  browserContext() {\n    return this._target.browserContext();\n  }\n\n  _onTargetCrashed() {\n    this.emit('error', new Error('Page crashed!'));\n  }\n  /**\n   * @param {!Protocol.Log.entryAddedPayload} event\n   */\n\n\n  _onLogEntryAdded(event) {\n    const {\n      level,\n      text,\n      args,\n      source,\n      url,\n      lineNumber\n    } = event.entry;\n    if (args) args.map(arg => helper.releaseObject(this._client, arg));\n    if (source !== 'worker') this.emit(Events.Page.Console, new ConsoleMessage(level, text, [], {\n      url,\n      lineNumber\n    }));\n  }\n  /**\n   * @return {!Puppeteer.Frame}\n   */\n\n\n  mainFrame() {\n    return this._frameManager.mainFrame();\n  }\n  /**\n   * @return {!Keyboard}\n   */\n\n\n  get keyboard() {\n    return this._keyboard;\n  }\n  /**\n   * @return {!Touchscreen}\n   */\n\n\n  get touchscreen() {\n    return this._touchscreen;\n  }\n  /**\n   * @return {!Coverage}\n   */\n\n\n  get coverage() {\n    return this._coverage;\n  }\n  /**\n   * @return {!Tracing}\n   */\n\n\n  get tracing() {\n    return this._tracing;\n  }\n  /**\n   * @return {!Accessibility}\n   */\n\n\n  get accessibility() {\n    return this._accessibility;\n  }\n  /**\n   * @return {!Array<Puppeteer.Frame>}\n   */\n\n\n  frames() {\n    return this._frameManager.frames();\n  }\n  /**\n   * @return {!Array<!Worker>}\n   */\n\n\n  workers() {\n    return Array.from(this._workers.values());\n  }\n  /**\n   * @param {boolean} value\n   */\n\n\n  async setRequestInterception(value) {\n    return this._frameManager.networkManager().setRequestInterception(value);\n  }\n  /**\n   * @param {boolean} enabled\n   */\n\n\n  setOfflineMode(enabled) {\n    return this._frameManager.networkManager().setOfflineMode(enabled);\n  }\n  /**\n   * @param {number} timeout\n   */\n\n\n  setDefaultNavigationTimeout(timeout) {\n    this._timeoutSettings.setDefaultNavigationTimeout(timeout);\n  }\n  /**\n   * @param {number} timeout\n   */\n\n\n  setDefaultTimeout(timeout) {\n    this._timeoutSettings.setDefaultTimeout(timeout);\n  }\n  /**\n   * @param {string} selector\n   * @return {!Promise<?Puppeteer.ElementHandle>}\n   */\n\n\n  async $(selector) {\n    return this.mainFrame().$(selector);\n  }\n  /**\n   * @param {Function|string} pageFunction\n   * @param {!Array<*>} args\n   * @return {!Promise<!Puppeteer.JSHandle>}\n   */\n\n\n  async evaluateHandle(pageFunction, ...args) {\n    const context = await this.mainFrame().executionContext();\n    return context.evaluateHandle(pageFunction, ...args);\n  }\n  /**\n   * @param {!Puppeteer.JSHandle} prototypeHandle\n   * @return {!Promise<!Puppeteer.JSHandle>}\n   */\n\n\n  async queryObjects(prototypeHandle) {\n    const context = await this.mainFrame().executionContext();\n    return context.queryObjects(prototypeHandle);\n  }\n  /**\n   * @param {string} selector\n   * @param {Function|string} pageFunction\n   * @param {!Array<*>} args\n   * @return {!Promise<(!Object|undefined)>}\n   */\n\n\n  async $eval(selector, pageFunction, ...args) {\n    return this.mainFrame().$eval(selector, pageFunction, ...args);\n  }\n  /**\n   * @param {string} selector\n   * @param {Function|string} pageFunction\n   * @param {!Array<*>} args\n   * @return {!Promise<(!Object|undefined)>}\n   */\n\n\n  async $$eval(selector, pageFunction, ...args) {\n    return this.mainFrame().$$eval(selector, pageFunction, ...args);\n  }\n  /**\n   * @param {string} selector\n   * @return {!Promise<!Array<!Puppeteer.ElementHandle>>}\n   */\n\n\n  async $$(selector) {\n    return this.mainFrame().$$(selector);\n  }\n  /**\n   * @param {string} expression\n   * @return {!Promise<!Array<!Puppeteer.ElementHandle>>}\n   */\n\n\n  async $x(expression) {\n    return this.mainFrame().$x(expression);\n  }\n  /**\n   * @param {!Array<string>} urls\n   * @return {!Promise<!Array<Network.Cookie>>}\n   */\n\n\n  async cookies(...urls) {\n    return (await this._client.send('Network.getCookies', {\n      urls: urls.length ? urls : [this.url()]\n    })).cookies;\n  }\n  /**\n   * @param {Array<Protocol.Network.deleteCookiesParameters>} cookies\n   */\n\n\n  async deleteCookie(...cookies) {\n    const pageURL = this.url();\n\n    for (const cookie of cookies) {\n      const item = Object.assign({}, cookie);\n      if (!cookie.url && pageURL.startsWith('http')) item.url = pageURL;\n      await this._client.send('Network.deleteCookies', item);\n    }\n  }\n  /**\n   * @param {Array<Network.CookieParam>} cookies\n   */\n\n\n  async setCookie(...cookies) {\n    const pageURL = this.url();\n    const startsWithHTTP = pageURL.startsWith('http');\n    const items = cookies.map(cookie => {\n      const item = Object.assign({}, cookie);\n      if (!item.url && startsWithHTTP) item.url = pageURL;\n      assert(item.url !== 'about:blank', `Blank page can not have cookie \"${item.name}\"`);\n      assert(!String.prototype.startsWith.call(item.url || '', 'data:'), `Data URL page can not have cookie \"${item.name}\"`);\n      return item;\n    });\n    await this.deleteCookie(...items);\n    if (items.length) await this._client.send('Network.setCookies', {\n      cookies: items\n    });\n  }\n  /**\n   * @param {!{url?: string, path?: string, content?: string, type?: string}} options\n   * @return {!Promise<!Puppeteer.ElementHandle>}\n   */\n\n\n  async addScriptTag(options) {\n    return this.mainFrame().addScriptTag(options);\n  }\n  /**\n   * @param {!{url?: string, path?: string, content?: string}} options\n   * @return {!Promise<!Puppeteer.ElementHandle>}\n   */\n\n\n  async addStyleTag(options) {\n    return this.mainFrame().addStyleTag(options);\n  }\n  /**\n   * @param {string} name\n   * @param {Function} puppeteerFunction\n   */\n\n\n  async exposeFunction(name, puppeteerFunction) {\n    if (this._pageBindings.has(name)) throw new Error(`Failed to add page binding with name ${name}: window['${name}'] already exists!`);\n\n    this._pageBindings.set(name, puppeteerFunction);\n\n    const expression = helper.evaluationString(addPageBinding, name);\n    await this._client.send('Runtime.addBinding', {\n      name: name\n    });\n    await this._client.send('Page.addScriptToEvaluateOnNewDocument', {\n      source: expression\n    });\n    await Promise.all(this.frames().map(frame => frame.evaluate(expression).catch(debugError)));\n\n    function addPageBinding(bindingName) {\n      const binding = window[bindingName];\n\n      window[bindingName] = (...args) => {\n        const me = window[bindingName];\n        let callbacks = me['callbacks'];\n\n        if (!callbacks) {\n          callbacks = new Map();\n          me['callbacks'] = callbacks;\n        }\n\n        const seq = (me['lastSeq'] || 0) + 1;\n        me['lastSeq'] = seq;\n        const promise = new Promise((resolve, reject) => callbacks.set(seq, {\n          resolve,\n          reject\n        }));\n        binding(JSON.stringify({\n          name: bindingName,\n          seq,\n          args\n        }));\n        return promise;\n      };\n    }\n  }\n  /**\n   * @param {?{username: string, password: string}} credentials\n   */\n\n\n  async authenticate(credentials) {\n    return this._frameManager.networkManager().authenticate(credentials);\n  }\n  /**\n   * @param {!Object<string, string>} headers\n   */\n\n\n  async setExtraHTTPHeaders(headers) {\n    return this._frameManager.networkManager().setExtraHTTPHeaders(headers);\n  }\n  /**\n   * @param {string} userAgent\n   */\n\n\n  async setUserAgent(userAgent) {\n    return this._frameManager.networkManager().setUserAgent(userAgent);\n  }\n  /**\n   * @return {!Promise<!Metrics>}\n   */\n\n\n  async metrics() {\n    const response = await this._client.send('Performance.getMetrics');\n    return this._buildMetricsObject(response.metrics);\n  }\n  /**\n   * @param {!Protocol.Performance.metricsPayload} event\n   */\n\n\n  _emitMetrics(event) {\n    this.emit(Events.Page.Metrics, {\n      title: event.title,\n      metrics: this._buildMetricsObject(event.metrics)\n    });\n  }\n  /**\n   * @param {?Array<!Protocol.Performance.Metric>} metrics\n   * @return {!Metrics}\n   */\n\n\n  _buildMetricsObject(metrics) {\n    const result = {};\n\n    for (const metric of metrics || []) {\n      if (supportedMetrics.has(metric.name)) result[metric.name] = metric.value;\n    }\n\n    return result;\n  }\n  /**\n   * @param {!Protocol.Runtime.ExceptionDetails} exceptionDetails\n   */\n\n\n  _handleException(exceptionDetails) {\n    const message = helper.getExceptionMessage(exceptionDetails);\n    const err = new Error(message);\n    err.stack = ''; // Don't report clientside error with a node stack attached\n\n    this.emit(Events.Page.PageError, err);\n  }\n  /**\n   * @param {!Protocol.Runtime.consoleAPICalledPayload} event\n   */\n\n\n  async _onConsoleAPI(event) {\n    if (event.executionContextId === 0) {\n      // DevTools protocol stores the last 1000 console messages. These\n      // messages are always reported even for removed execution contexts. In\n      // this case, they are marked with executionContextId = 0 and are\n      // reported upon enabling Runtime agent.\n      //\n      // Ignore these messages since:\n      // - there's no execution context we can use to operate with message\n      //   arguments\n      // - these messages are reported before Puppeteer clients can subscribe\n      //   to the 'console'\n      //   page event.\n      //\n      // @see https://github.com/puppeteer/puppeteer/issues/3865\n      return;\n    }\n\n    const context = this._frameManager.executionContextById(event.executionContextId);\n\n    const values = event.args.map(arg => createJSHandle(context, arg));\n\n    this._addConsoleMessage(event.type, values, event.stackTrace);\n  }\n  /**\n   * @param {!Protocol.Runtime.bindingCalledPayload} event\n   */\n\n\n  async _onBindingCalled(event) {\n    const {\n      name,\n      seq,\n      args\n    } = JSON.parse(event.payload);\n    let expression = null;\n\n    try {\n      const result = await this._pageBindings.get(name)(...args);\n      expression = helper.evaluationString(deliverResult, name, seq, result);\n    } catch (error) {\n      if (error instanceof Error) expression = helper.evaluationString(deliverError, name, seq, error.message, error.stack);else expression = helper.evaluationString(deliverErrorValue, name, seq, error);\n    }\n\n    this._client.send('Runtime.evaluate', {\n      expression,\n      contextId: event.executionContextId\n    }).catch(debugError);\n    /**\n     * @param {string} name\n     * @param {number} seq\n     * @param {*} result\n     */\n\n\n    function deliverResult(name, seq, result) {\n      window[name]['callbacks'].get(seq).resolve(result);\n      window[name]['callbacks'].delete(seq);\n    }\n    /**\n     * @param {string} name\n     * @param {number} seq\n     * @param {string} message\n     * @param {string} stack\n     */\n\n\n    function deliverError(name, seq, message, stack) {\n      const error = new Error(message);\n      error.stack = stack;\n      window[name]['callbacks'].get(seq).reject(error);\n      window[name]['callbacks'].delete(seq);\n    }\n    /**\n     * @param {string} name\n     * @param {number} seq\n     * @param {*} value\n     */\n\n\n    function deliverErrorValue(name, seq, value) {\n      window[name]['callbacks'].get(seq).reject(value);\n      window[name]['callbacks'].delete(seq);\n    }\n  }\n  /**\n   * @param {string} type\n   * @param {!Array<!Puppeteer.JSHandle>} args\n   * @param {Protocol.Runtime.StackTrace=} stackTrace\n   */\n\n\n  _addConsoleMessage(type, args, stackTrace) {\n    if (!this.listenerCount(Events.Page.Console)) {\n      args.forEach(arg => arg.dispose());\n      return;\n    }\n\n    const textTokens = [];\n\n    for (const arg of args) {\n      const remoteObject = arg._remoteObject;\n      if (remoteObject.objectId) textTokens.push(arg.toString());else textTokens.push(helper.valueFromRemoteObject(remoteObject));\n    }\n\n    const location = stackTrace && stackTrace.callFrames.length ? {\n      url: stackTrace.callFrames[0].url,\n      lineNumber: stackTrace.callFrames[0].lineNumber,\n      columnNumber: stackTrace.callFrames[0].columnNumber\n    } : {};\n    const message = new ConsoleMessage(type, textTokens.join(' '), args, location);\n    this.emit(Events.Page.Console, message);\n  }\n\n  _onDialog(event) {\n    let dialogType = null;\n    if (event.type === 'alert') dialogType = Dialog.Type.Alert;else if (event.type === 'confirm') dialogType = Dialog.Type.Confirm;else if (event.type === 'prompt') dialogType = Dialog.Type.Prompt;else if (event.type === 'beforeunload') dialogType = Dialog.Type.BeforeUnload;\n    assert(dialogType, 'Unknown javascript dialog type: ' + event.type);\n    const dialog = new Dialog(this._client, dialogType, event.message, event.defaultPrompt);\n    this.emit(Events.Page.Dialog, dialog);\n  }\n  /**\n   * @return {!string}\n   */\n\n\n  url() {\n    return this.mainFrame().url();\n  }\n  /**\n   * @return {!Promise<string>}\n   */\n\n\n  async content() {\n    return await this._frameManager.mainFrame().content();\n  }\n  /**\n   * @param {string} html\n   * @param {!{timeout?: number, waitUntil?: string|!Array<string>}=} options\n   */\n\n\n  async setContent(html, options) {\n    await this._frameManager.mainFrame().setContent(html, options);\n  }\n  /**\n   * @param {string} url\n   * @param {!{referer?: string, timeout?: number, waitUntil?: string|!Array<string>}=} options\n   * @return {!Promise<?Puppeteer.Response>}\n   */\n\n\n  async goto(url, options) {\n    return await this._frameManager.mainFrame().goto(url, options);\n  }\n  /**\n   * @param {!{timeout?: number, waitUntil?: string|!Array<string>}=} options\n   * @return {!Promise<?Puppeteer.Response>}\n   */\n\n\n  async reload(options) {\n    const [response] = await Promise.all([this.waitForNavigation(options), this._client.send('Page.reload')]);\n    return response;\n  }\n  /**\n   * @param {!{timeout?: number, waitUntil?: string|!Array<string>}=} options\n   * @return {!Promise<?Puppeteer.Response>}\n   */\n\n\n  async waitForNavigation(options = {}) {\n    return await this._frameManager.mainFrame().waitForNavigation(options);\n  }\n\n  _sessionClosePromise() {\n    if (!this._disconnectPromise) this._disconnectPromise = new Promise(fulfill => this._client.once(Events.CDPSession.Disconnected, () => fulfill(new Error('Target closed'))));\n    return this._disconnectPromise;\n  }\n  /**\n   * @param {(string|Function)} urlOrPredicate\n   * @param {!{timeout?: number}=} options\n   * @return {!Promise<!Puppeteer.Request>}\n   */\n\n\n  async waitForRequest(urlOrPredicate, options = {}) {\n    const {\n      timeout = this._timeoutSettings.timeout()\n    } = options;\n    return helper.waitForEvent(this._frameManager.networkManager(), Events.NetworkManager.Request, request => {\n      if (helper.isString(urlOrPredicate)) return urlOrPredicate === request.url();\n      if (typeof urlOrPredicate === 'function') return !!urlOrPredicate(request);\n      return false;\n    }, timeout, this._sessionClosePromise());\n  }\n  /**\n   * @param {(string|Function)} urlOrPredicate\n   * @param {!{timeout?: number}=} options\n   * @return {!Promise<!Puppeteer.Response>}\n   */\n\n\n  async waitForResponse(urlOrPredicate, options = {}) {\n    const {\n      timeout = this._timeoutSettings.timeout()\n    } = options;\n    return helper.waitForEvent(this._frameManager.networkManager(), Events.NetworkManager.Response, response => {\n      if (helper.isString(urlOrPredicate)) return urlOrPredicate === response.url();\n      if (typeof urlOrPredicate === 'function') return !!urlOrPredicate(response);\n      return false;\n    }, timeout, this._sessionClosePromise());\n  }\n  /**\n   * @param {!{timeout?: number, waitUntil?: string|!Array<string>}=} options\n   * @return {!Promise<?Puppeteer.Response>}\n   */\n\n\n  async goBack(options) {\n    return this._go(-1, options);\n  }\n  /**\n   * @param {!{timeout?: number, waitUntil?: string|!Array<string>}=} options\n   * @return {!Promise<?Puppeteer.Response>}\n   */\n\n\n  async goForward(options) {\n    return this._go(+1, options);\n  }\n  /**\n   * @param {!{timeout?: number, waitUntil?: string|!Array<string>}=} options\n   * @return {!Promise<?Puppeteer.Response>}\n   */\n\n\n  async _go(delta, options) {\n    const history = await this._client.send('Page.getNavigationHistory');\n    const entry = history.entries[history.currentIndex + delta];\n    if (!entry) return null;\n    const [response] = await Promise.all([this.waitForNavigation(options), this._client.send('Page.navigateToHistoryEntry', {\n      entryId: entry.id\n    })]);\n    return response;\n  }\n\n  async bringToFront() {\n    await this._client.send('Page.bringToFront');\n  }\n  /**\n   * @param {!{viewport: !Puppeteer.Viewport, userAgent: string}} options\n   */\n\n\n  async emulate(options) {\n    await Promise.all([this.setViewport(options.viewport), this.setUserAgent(options.userAgent)]);\n  }\n  /**\n   * @param {boolean} enabled\n   */\n\n\n  async setJavaScriptEnabled(enabled) {\n    if (this._javascriptEnabled === enabled) return;\n    this._javascriptEnabled = enabled;\n    await this._client.send('Emulation.setScriptExecutionDisabled', {\n      value: !enabled\n    });\n  }\n  /**\n   * @param {boolean} enabled\n   */\n\n\n  async setBypassCSP(enabled) {\n    await this._client.send('Page.setBypassCSP', {\n      enabled\n    });\n  }\n  /**\n   * @param {?string} type\n   */\n\n\n  async emulateMediaType(type) {\n    assert(type === 'screen' || type === 'print' || type === null, 'Unsupported media type: ' + type);\n    await this._client.send('Emulation.setEmulatedMedia', {\n      media: type || ''\n    });\n  }\n  /**\n   * @param {?Array<MediaFeature>} features\n   */\n\n\n  async emulateMediaFeatures(features) {\n    if (features === null) await this._client.send('Emulation.setEmulatedMedia', {\n      features: null\n    });\n\n    if (Array.isArray(features)) {\n      features.every(mediaFeature => {\n        const name = mediaFeature.name;\n        assert(/^prefers-(?:color-scheme|reduced-motion)$/.test(name), 'Unsupported media feature: ' + name);\n        return true;\n      });\n      await this._client.send('Emulation.setEmulatedMedia', {\n        features: features\n      });\n    }\n  }\n  /**\n   * @param {?string} timezoneId\n   */\n\n\n  async emulateTimezone(timezoneId) {\n    try {\n      await this._client.send('Emulation.setTimezoneOverride', {\n        timezoneId: timezoneId || ''\n      });\n    } catch (exception) {\n      if (exception.message.includes('Invalid timezone')) throw new Error(`Invalid timezone ID: ${timezoneId}`);\n      throw exception;\n    }\n  }\n  /**\n   * @param {!Puppeteer.Viewport} viewport\n   */\n\n\n  async setViewport(viewport) {\n    const needsReload = await this._emulationManager.emulateViewport(viewport);\n    this._viewport = viewport;\n    if (needsReload) await this.reload();\n  }\n  /**\n   * @return {?Puppeteer.Viewport}\n   */\n\n\n  viewport() {\n    return this._viewport;\n  }\n  /**\n   * @param {Function|string} pageFunction\n   * @param {!Array<*>} args\n   * @return {!Promise<*>}\n   */\n\n\n  async evaluate(pageFunction, ...args) {\n    return this._frameManager.mainFrame().evaluate(pageFunction, ...args);\n  }\n  /**\n   * @param {Function|string} pageFunction\n   * @param {!Array<*>} args\n   */\n\n\n  async evaluateOnNewDocument(pageFunction, ...args) {\n    const source = helper.evaluationString(pageFunction, ...args);\n    await this._client.send('Page.addScriptToEvaluateOnNewDocument', {\n      source\n    });\n  }\n  /**\n   * @param {boolean} enabled\n   */\n\n\n  async setCacheEnabled(enabled = true) {\n    await this._frameManager.networkManager().setCacheEnabled(enabled);\n  }\n  /**\n   * @param {!ScreenshotOptions=} options\n   * @return {!Promise<!Buffer|!String>}\n   */\n\n\n  async screenshot(options = {}) {\n    let screenshotType = null; // options.type takes precedence over inferring the type from options.path\n    // because it may be a 0-length file with no extension created beforehand (i.e. as a temp file).\n\n    if (options.type) {\n      assert(options.type === 'png' || options.type === 'jpeg', 'Unknown options.type value: ' + options.type);\n      screenshotType = options.type;\n    } else if (options.path) {\n      const mimeType = mime.getType(options.path);\n      if (mimeType === 'image/png') screenshotType = 'png';else if (mimeType === 'image/jpeg') screenshotType = 'jpeg';\n      assert(screenshotType, 'Unsupported screenshot mime type: ' + mimeType);\n    }\n\n    if (!screenshotType) screenshotType = 'png';\n\n    if (options.quality) {\n      assert(screenshotType === 'jpeg', 'options.quality is unsupported for the ' + screenshotType + ' screenshots');\n      assert(typeof options.quality === 'number', 'Expected options.quality to be a number but found ' + typeof options.quality);\n      assert(Number.isInteger(options.quality), 'Expected options.quality to be an integer');\n      assert(options.quality >= 0 && options.quality <= 100, 'Expected options.quality to be between 0 and 100 (inclusive), got ' + options.quality);\n    }\n\n    assert(!options.clip || !options.fullPage, 'options.clip and options.fullPage are exclusive');\n\n    if (options.clip) {\n      assert(typeof options.clip.x === 'number', 'Expected options.clip.x to be a number but found ' + typeof options.clip.x);\n      assert(typeof options.clip.y === 'number', 'Expected options.clip.y to be a number but found ' + typeof options.clip.y);\n      assert(typeof options.clip.width === 'number', 'Expected options.clip.width to be a number but found ' + typeof options.clip.width);\n      assert(typeof options.clip.height === 'number', 'Expected options.clip.height to be a number but found ' + typeof options.clip.height);\n      assert(options.clip.width !== 0, 'Expected options.clip.width not to be 0.');\n      assert(options.clip.height !== 0, 'Expected options.clip.height not to be 0.');\n    }\n\n    return this._screenshotTaskQueue.postTask(this._screenshotTask.bind(this, screenshotType, options));\n  }\n  /**\n   * @param {\"png\"|\"jpeg\"} format\n   * @param {!ScreenshotOptions=} options\n   * @return {!Promise<!Buffer|!String>}\n   */\n\n\n  async _screenshotTask(format, options) {\n    await this._client.send('Target.activateTarget', {\n      targetId: this._target._targetId\n    });\n    let clip = options.clip ? processClip(options.clip) : undefined;\n\n    if (options.fullPage) {\n      const metrics = await this._client.send('Page.getLayoutMetrics');\n      const width = Math.ceil(metrics.contentSize.width);\n      const height = Math.ceil(metrics.contentSize.height); // Overwrite clip for full page at all times.\n\n      clip = {\n        x: 0,\n        y: 0,\n        width,\n        height,\n        scale: 1\n      };\n      const {\n        isMobile = false,\n        deviceScaleFactor = 1,\n        isLandscape = false\n      } = this._viewport || {};\n      /** @type {!Protocol.Emulation.ScreenOrientation} */\n\n      const screenOrientation = isLandscape ? {\n        angle: 90,\n        type: 'landscapePrimary'\n      } : {\n        angle: 0,\n        type: 'portraitPrimary'\n      };\n      await this._client.send('Emulation.setDeviceMetricsOverride', {\n        mobile: isMobile,\n        width,\n        height,\n        deviceScaleFactor,\n        screenOrientation\n      });\n    }\n\n    const shouldSetDefaultBackground = options.omitBackground && format === 'png';\n    if (shouldSetDefaultBackground) await this._client.send('Emulation.setDefaultBackgroundColorOverride', {\n      color: {\n        r: 0,\n        g: 0,\n        b: 0,\n        a: 0\n      }\n    });\n    const result = await this._client.send('Page.captureScreenshot', {\n      format,\n      quality: options.quality,\n      clip\n    });\n    if (shouldSetDefaultBackground) await this._client.send('Emulation.setDefaultBackgroundColorOverride');\n    if (options.fullPage && this._viewport) await this.setViewport(this._viewport);\n    const buffer = options.encoding === 'base64' ? result.data : Buffer.from(result.data, 'base64');\n    if (options.path) await writeFileAsync(options.path, buffer);\n    return buffer;\n\n    function processClip(clip) {\n      const x = Math.round(clip.x);\n      const y = Math.round(clip.y);\n      const width = Math.round(clip.width + clip.x - x);\n      const height = Math.round(clip.height + clip.y - y);\n      return {\n        x,\n        y,\n        width,\n        height,\n        scale: 1\n      };\n    }\n  }\n  /**\n   * @param {!PDFOptions=} options\n   * @return {!Promise<!Buffer>}\n   */\n\n\n  async pdf(options = {}) {\n    const {\n      scale = 1,\n      displayHeaderFooter = false,\n      headerTemplate = '',\n      footerTemplate = '',\n      printBackground = false,\n      landscape = false,\n      pageRanges = '',\n      preferCSSPageSize = false,\n      margin = {},\n      path = null\n    } = options;\n    let paperWidth = 8.5;\n    let paperHeight = 11;\n\n    if (options.format) {\n      const format = Page.PaperFormats[options.format.toLowerCase()];\n      assert(format, 'Unknown paper format: ' + options.format);\n      paperWidth = format.width;\n      paperHeight = format.height;\n    } else {\n      paperWidth = convertPrintParameterToInches(options.width) || paperWidth;\n      paperHeight = convertPrintParameterToInches(options.height) || paperHeight;\n    }\n\n    const marginTop = convertPrintParameterToInches(margin.top) || 0;\n    const marginLeft = convertPrintParameterToInches(margin.left) || 0;\n    const marginBottom = convertPrintParameterToInches(margin.bottom) || 0;\n    const marginRight = convertPrintParameterToInches(margin.right) || 0;\n    const result = await this._client.send('Page.printToPDF', {\n      transferMode: 'ReturnAsStream',\n      landscape,\n      displayHeaderFooter,\n      headerTemplate,\n      footerTemplate,\n      printBackground,\n      scale,\n      paperWidth,\n      paperHeight,\n      marginTop,\n      marginBottom,\n      marginLeft,\n      marginRight,\n      pageRanges,\n      preferCSSPageSize\n    });\n    return await helper.readProtocolStream(this._client, result.stream, path);\n  }\n  /**\n   * @return {!Promise<string>}\n   */\n\n\n  async title() {\n    return this.mainFrame().title();\n  }\n  /**\n   * @param {!{runBeforeUnload: (boolean|undefined)}=} options\n   */\n\n\n  async close(options = {\n    runBeforeUnload: undefined\n  }) {\n    assert(!!this._client._connection, 'Protocol error: Connection closed. Most likely the page has been closed.');\n    const runBeforeUnload = !!options.runBeforeUnload;\n\n    if (runBeforeUnload) {\n      await this._client.send('Page.close');\n    } else {\n      await this._client._connection.send('Target.closeTarget', {\n        targetId: this._target._targetId\n      });\n      await this._target._isClosedPromise;\n    }\n  }\n  /**\n   * @return {boolean}\n   */\n\n\n  isClosed() {\n    return this._closed;\n  }\n  /**\n   * @return {!Mouse}\n   */\n\n\n  get mouse() {\n    return this._mouse;\n  }\n  /**\n   * @param {string} selector\n   * @param {!{delay?: number, button?: \"left\"|\"right\"|\"middle\", clickCount?: number}=} options\n   */\n\n\n  click(selector, options = {}) {\n    return this.mainFrame().click(selector, options);\n  }\n  /**\n   * @param {string} selector\n   */\n\n\n  focus(selector) {\n    return this.mainFrame().focus(selector);\n  }\n  /**\n   * @param {string} selector\n   */\n\n\n  hover(selector) {\n    return this.mainFrame().hover(selector);\n  }\n  /**\n   * @param {string} selector\n   * @param {!Array<string>} values\n   * @return {!Promise<!Array<string>>}\n   */\n\n\n  select(selector, ...values) {\n    return this.mainFrame().select(selector, ...values);\n  }\n  /**\n   * @param {string} selector\n   */\n\n\n  tap(selector) {\n    return this.mainFrame().tap(selector);\n  }\n  /**\n   * @param {string} selector\n   * @param {string} text\n   * @param {{delay: (number|undefined)}=} options\n   */\n\n\n  type(selector, text, options) {\n    return this.mainFrame().type(selector, text, options);\n  }\n  /**\n   * @param {(string|number|Function)} selectorOrFunctionOrTimeout\n   * @param {!{visible?: boolean, hidden?: boolean, timeout?: number, polling?: string|number}=} options\n   * @param {!Array<*>} args\n   * @return {!Promise<!Puppeteer.JSHandle>}\n   */\n\n\n  waitFor(selectorOrFunctionOrTimeout, options = {}, ...args) {\n    return this.mainFrame().waitFor(selectorOrFunctionOrTimeout, options, ...args);\n  }\n  /**\n   * @param {string} selector\n   * @param {!{visible?: boolean, hidden?: boolean, timeout?: number}=} options\n   * @return {!Promise<?Puppeteer.ElementHandle>}\n   */\n\n\n  waitForSelector(selector, options = {}) {\n    return this.mainFrame().waitForSelector(selector, options);\n  }\n  /**\n   * @param {string} xpath\n   * @param {!{visible?: boolean, hidden?: boolean, timeout?: number}=} options\n   * @return {!Promise<?Puppeteer.ElementHandle>}\n   */\n\n\n  waitForXPath(xpath, options = {}) {\n    return this.mainFrame().waitForXPath(xpath, options);\n  }\n  /**\n   * @param {Function} pageFunction\n   * @param {!{polling?: string|number, timeout?: number}=} options\n   * @param {!Array<*>} args\n   * @return {!Promise<!Puppeteer.JSHandle>}\n   */\n\n\n  waitForFunction(pageFunction, options = {}, ...args) {\n    return this.mainFrame().waitForFunction(pageFunction, options, ...args);\n  }\n\n} // Expose alias for deprecated method.\n\n\nPage.prototype.emulateMedia = Page.prototype.emulateMediaType;\n/**\n * @typedef {Object} PDFOptions\n * @property {number=} scale\n * @property {boolean=} displayHeaderFooter\n * @property {string=} headerTemplate\n * @property {string=} footerTemplate\n * @property {boolean=} printBackground\n * @property {boolean=} landscape\n * @property {string=} pageRanges\n * @property {string=} format\n * @property {string|number=} width\n * @property {string|number=} height\n * @property {boolean=} preferCSSPageSize\n * @property {!{top?: string|number, bottom?: string|number, left?: string|number, right?: string|number}=} margin\n * @property {string=} path\n */\n\n/**\n * @typedef {Object} Metrics\n * @property {number=} Timestamp\n * @property {number=} Documents\n * @property {number=} Frames\n * @property {number=} JSEventListeners\n * @property {number=} Nodes\n * @property {number=} LayoutCount\n * @property {number=} RecalcStyleCount\n * @property {number=} LayoutDuration\n * @property {number=} RecalcStyleDuration\n * @property {number=} ScriptDuration\n * @property {number=} TaskDuration\n * @property {number=} JSHeapUsedSize\n * @property {number=} JSHeapTotalSize\n */\n\n/**\n * @typedef {Object} ScreenshotOptions\n * @property {string=} type\n * @property {string=} path\n * @property {boolean=} fullPage\n * @property {{x: number, y: number, width: number, height: number}=} clip\n * @property {number=} quality\n * @property {boolean=} omitBackground\n * @property {string=} encoding\n */\n\n/**\n * @typedef {Object} MediaFeature\n * @property {string} name\n * @property {string} value\n */\n\n/** @type {!Set<string>} */\n\nconst supportedMetrics = new Set(['Timestamp', 'Documents', 'Frames', 'JSEventListeners', 'Nodes', 'LayoutCount', 'RecalcStyleCount', 'LayoutDuration', 'RecalcStyleDuration', 'ScriptDuration', 'TaskDuration', 'JSHeapUsedSize', 'JSHeapTotalSize']);\n/** @enum {!{width: number, height: number}} */\n\nPage.PaperFormats = {\n  letter: {\n    width: 8.5,\n    height: 11\n  },\n  legal: {\n    width: 8.5,\n    height: 14\n  },\n  tabloid: {\n    width: 11,\n    height: 17\n  },\n  ledger: {\n    width: 17,\n    height: 11\n  },\n  a0: {\n    width: 33.1,\n    height: 46.8\n  },\n  a1: {\n    width: 23.4,\n    height: 33.1\n  },\n  a2: {\n    width: 16.54,\n    height: 23.4\n  },\n  a3: {\n    width: 11.7,\n    height: 16.54\n  },\n  a4: {\n    width: 8.27,\n    height: 11.7\n  },\n  a5: {\n    width: 5.83,\n    height: 8.27\n  },\n  a6: {\n    width: 4.13,\n    height: 5.83\n  }\n};\nconst unitToPixels = {\n  'px': 1,\n  'in': 96,\n  'cm': 37.8,\n  'mm': 3.78\n};\n/**\n * @param {(string|number|undefined)} parameter\n * @return {(number|undefined)}\n */\n\nfunction convertPrintParameterToInches(parameter) {\n  if (typeof parameter === 'undefined') return undefined;\n  let pixels;\n\n  if (helper.isNumber(parameter)) {\n    // Treat numbers as pixel values to be aligned with phantom's paperSize.\n    pixels =\n    /** @type {number} */\n    parameter;\n  } else if (helper.isString(parameter)) {\n    const text =\n    /** @type {string} */\n    parameter;\n    let unit = text.substring(text.length - 2).toLowerCase();\n    let valueText = '';\n\n    if (unitToPixels.hasOwnProperty(unit)) {\n      valueText = text.substring(0, text.length - 2);\n    } else {\n      // In case of unknown unit try to parse the whole parameter as number of pixels.\n      // This is consistent with phantom's paperSize behavior.\n      unit = 'px';\n      valueText = text;\n    }\n\n    const value = Number(valueText);\n    assert(!isNaN(value), 'Failed to parse parameter value: ' + text);\n    pixels = value * unitToPixels[unit];\n  } else {\n    throw new Error('page.pdf() Cannot handle parameter type: ' + typeof parameter);\n  }\n\n  return pixels / 96;\n}\n/**\n * @typedef {Object} Network.Cookie\n * @property {string} name\n * @property {string} value\n * @property {string} domain\n * @property {string} path\n * @property {number} expires\n * @property {number} size\n * @property {boolean} httpOnly\n * @property {boolean} secure\n * @property {boolean} session\n * @property {(\"Strict\"|\"Lax\"|\"Extended\"|\"None\")=} sameSite\n */\n\n/**\n * @typedef {Object} Network.CookieParam\n * @property {string} name\n * @property {string} value\n * @property {string=} url\n * @property {string=} domain\n * @property {string=} path\n * @property {number=} expires\n * @property {boolean=} httpOnly\n * @property {boolean=} secure\n * @property {(\"Strict\"|\"Lax\")=} sameSite\n */\n\n/**\n * @typedef {Object} ConsoleMessage.Location\n * @property {string=} url\n * @property {number=} lineNumber\n * @property {number=} columnNumber\n */\n\n\nclass ConsoleMessage {\n  /**\n   * @param {string} type\n   * @param {string} text\n   * @param {!Array<!Puppeteer.JSHandle>} args\n   * @param {ConsoleMessage.Location} location\n   */\n  constructor(type, text, args, location = {}) {\n    this._type = type;\n    this._text = text;\n    this._args = args;\n    this._location = location;\n  }\n  /**\n   * @return {string}\n   */\n\n\n  type() {\n    return this._type;\n  }\n  /**\n   * @return {string}\n   */\n\n\n  text() {\n    return this._text;\n  }\n  /**\n   * @return {!Array<!Puppeteer.JSHandle>}\n   */\n\n\n  args() {\n    return this._args;\n  }\n  /**\n   * @return {Object}\n   */\n\n\n  location() {\n    return this._location;\n  }\n\n}\n\nclass FileChooser {\n  /**\n   * @param {Puppeteer.CDPSession} client\n   * @param {Puppeteer.ElementHandle} element\n   * @param {!Protocol.Page.fileChooserOpenedPayload} event\n   */\n  constructor(client, element, event) {\n    this._client = client;\n    this._element = element;\n    this._multiple = event.mode !== 'selectSingle';\n    this._handled = false;\n  }\n  /**\n   * @return {boolean}\n   */\n\n\n  isMultiple() {\n    return this._multiple;\n  }\n  /**\n   * @param {!Array<string>} filePaths\n   * @return {!Promise}\n   */\n\n\n  async accept(filePaths) {\n    assert(!this._handled, 'Cannot accept FileChooser which is already handled!');\n    this._handled = true;\n    await this._element.uploadFile(...filePaths);\n  }\n  /**\n   * @return {!Promise}\n   */\n\n\n  async cancel() {\n    assert(!this._handled, 'Cannot cancel FileChooser which is already handled!');\n    this._handled = true;\n  }\n\n}\n\nmodule.exports = {\n  Page,\n  ConsoleMessage,\n  FileChooser\n};","map":{"version":3,"sources":["/Users/marshoward/Development/code/river/frontend/app/node_modules/puppeteer/lib/Page.js"],"names":["fs","require","EventEmitter","mime","Events","Connection","Dialog","EmulationManager","FrameManager","Keyboard","Mouse","Touchscreen","Tracing","helper","debugError","assert","Coverage","Worker","createJSHandle","Accessibility","TimeoutSettings","writeFileAsync","promisify","writeFile","Page","create","client","target","ignoreHTTPSErrors","defaultViewport","screenshotTaskQueue","page","_initialize","setViewport","constructor","_closed","_client","_target","_keyboard","_mouse","_timeoutSettings","_touchscreen","_accessibility","_frameManager","_emulationManager","_tracing","_pageBindings","Map","_coverage","_javascriptEnabled","_viewport","_screenshotTaskQueue","_workers","on","event","targetInfo","type","send","sessionId","catch","session","fromSession","worker","url","_addConsoleMessage","bind","_handleException","set","emit","WorkerCreated","get","WorkerDestroyed","delete","FrameAttached","FrameDetached","FrameNavigated","networkManager","NetworkManager","Request","Response","RequestFailed","RequestFinished","_fileChooserInterceptors","Set","DOMContentLoaded","Load","_onConsoleAPI","_onBindingCalled","_onDialog","exception","exceptionDetails","_onTargetCrashed","_emitMetrics","_onLogEntryAdded","_onFileChooser","_isClosedPromise","then","Close","Promise","all","initialize","autoAttach","waitForDebuggerOnStart","flatten","size","frame","frameId","context","executionContext","element","_adoptBackendNodeId","backendNodeId","interceptors","Array","from","clear","fileChooser","FileChooser","interceptor","call","waitForFileChooser","options","enabled","timeout","callback","promise","x","add","waitWithTimeout","e","setGeolocation","longitude","latitude","accuracy","Error","browser","browserContext","level","text","args","source","lineNumber","entry","map","arg","releaseObject","Console","ConsoleMessage","mainFrame","keyboard","touchscreen","coverage","tracing","accessibility","frames","workers","values","setRequestInterception","value","setOfflineMode","setDefaultNavigationTimeout","setDefaultTimeout","$","selector","evaluateHandle","pageFunction","queryObjects","prototypeHandle","$eval","$$eval","$$","$x","expression","cookies","urls","length","deleteCookie","pageURL","cookie","item","Object","assign","startsWith","setCookie","startsWithHTTP","items","name","String","prototype","addScriptTag","addStyleTag","exposeFunction","puppeteerFunction","has","evaluationString","addPageBinding","evaluate","bindingName","binding","window","me","callbacks","seq","resolve","reject","JSON","stringify","authenticate","credentials","setExtraHTTPHeaders","headers","setUserAgent","userAgent","metrics","response","_buildMetricsObject","Metrics","title","result","metric","supportedMetrics","message","getExceptionMessage","err","stack","PageError","executionContextId","executionContextById","stackTrace","parse","payload","deliverResult","error","deliverError","deliverErrorValue","contextId","listenerCount","forEach","dispose","textTokens","remoteObject","_remoteObject","objectId","push","toString","valueFromRemoteObject","location","callFrames","columnNumber","join","dialogType","Type","Alert","Confirm","Prompt","BeforeUnload","dialog","defaultPrompt","content","setContent","html","goto","reload","waitForNavigation","_sessionClosePromise","_disconnectPromise","fulfill","once","CDPSession","Disconnected","waitForRequest","urlOrPredicate","waitForEvent","request","isString","waitForResponse","goBack","_go","goForward","delta","history","entries","currentIndex","entryId","id","bringToFront","emulate","viewport","setJavaScriptEnabled","setBypassCSP","emulateMediaType","media","emulateMediaFeatures","features","isArray","every","mediaFeature","test","emulateTimezone","timezoneId","includes","needsReload","emulateViewport","evaluateOnNewDocument","setCacheEnabled","screenshot","screenshotType","path","mimeType","getType","quality","Number","isInteger","clip","fullPage","y","width","height","postTask","_screenshotTask","format","targetId","_targetId","processClip","undefined","Math","ceil","contentSize","scale","isMobile","deviceScaleFactor","isLandscape","screenOrientation","angle","mobile","shouldSetDefaultBackground","omitBackground","color","r","g","b","a","buffer","encoding","data","Buffer","round","pdf","displayHeaderFooter","headerTemplate","footerTemplate","printBackground","landscape","pageRanges","preferCSSPageSize","margin","paperWidth","paperHeight","PaperFormats","toLowerCase","convertPrintParameterToInches","marginTop","top","marginLeft","left","marginBottom","bottom","marginRight","right","transferMode","readProtocolStream","stream","close","runBeforeUnload","_connection","isClosed","mouse","click","focus","hover","select","tap","waitFor","selectorOrFunctionOrTimeout","waitForSelector","waitForXPath","xpath","waitForFunction","emulateMedia","letter","legal","tabloid","ledger","a0","a1","a2","a3","a4","a5","a6","unitToPixels","parameter","pixels","isNumber","unit","substring","valueText","hasOwnProperty","isNaN","_type","_text","_args","_location","_element","_multiple","mode","_handled","isMultiple","accept","filePaths","uploadFile","cancel","module","exports"],"mappings":"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","sourcesContent":["/**\n * Copyright 2017 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst fs = require('fs');\nconst EventEmitter = require('events');\nconst mime = require('mime');\nconst {Events} = require('./Events');\nconst {Connection} = require('./Connection');\nconst {Dialog} = require('./Dialog');\nconst {EmulationManager} = require('./EmulationManager');\nconst {FrameManager} = require('./FrameManager');\nconst {Keyboard, Mouse, Touchscreen} = require('./Input');\nconst Tracing = require('./Tracing');\nconst {helper, debugError, assert} = require('./helper');\nconst {Coverage} = require('./Coverage');\nconst {Worker} = require('./Worker');\nconst {createJSHandle} = require('./JSHandle');\nconst {Accessibility} = require('./Accessibility');\nconst {TimeoutSettings} = require('./TimeoutSettings');\n\nconst writeFileAsync = helper.promisify(fs.writeFile);\n\nclass Page extends EventEmitter {\n  /**\n   * @param {!Puppeteer.CDPSession} client\n   * @param {!Puppeteer.Target} target\n   * @param {boolean} ignoreHTTPSErrors\n   * @param {?Puppeteer.Viewport} defaultViewport\n   * @param {!Puppeteer.TaskQueue} screenshotTaskQueue\n   * @return {!Promise<!Page>}\n   */\n  static async create(client, target, ignoreHTTPSErrors, defaultViewport, screenshotTaskQueue) {\n    const page = new Page(client, target, ignoreHTTPSErrors, screenshotTaskQueue);\n    await page._initialize();\n    if (defaultViewport)\n      await page.setViewport(defaultViewport);\n    return page;\n  }\n\n  /**\n   * @param {!Puppeteer.CDPSession} client\n   * @param {!Puppeteer.Target} target\n   * @param {boolean} ignoreHTTPSErrors\n   * @param {!Puppeteer.TaskQueue} screenshotTaskQueue\n   */\n  constructor(client, target, ignoreHTTPSErrors, screenshotTaskQueue) {\n    super();\n    this._closed = false;\n    this._client = client;\n    this._target = target;\n    this._keyboard = new Keyboard(client);\n    this._mouse = new Mouse(client, this._keyboard);\n    this._timeoutSettings = new TimeoutSettings();\n    this._touchscreen = new Touchscreen(client, this._keyboard);\n    this._accessibility = new Accessibility(client);\n    /** @type {!FrameManager} */\n    this._frameManager = new FrameManager(client, this, ignoreHTTPSErrors, this._timeoutSettings);\n    this._emulationManager = new EmulationManager(client);\n    this._tracing = new Tracing(client);\n    /** @type {!Map<string, Function>} */\n    this._pageBindings = new Map();\n    this._coverage = new Coverage(client);\n    this._javascriptEnabled = true;\n    /** @type {?Puppeteer.Viewport} */\n    this._viewport = null;\n\n    this._screenshotTaskQueue = screenshotTaskQueue;\n\n    /** @type {!Map<string, Worker>} */\n    this._workers = new Map();\n    client.on('Target.attachedToTarget', event => {\n      if (event.targetInfo.type !== 'worker') {\n        // If we don't detach from service workers, they will never die.\n        client.send('Target.detachFromTarget', {\n          sessionId: event.sessionId\n        }).catch(debugError);\n        return;\n      }\n      const session = Connection.fromSession(client).session(event.sessionId);\n      const worker = new Worker(session, event.targetInfo.url, this._addConsoleMessage.bind(this), this._handleException.bind(this));\n      this._workers.set(event.sessionId, worker);\n      this.emit(Events.Page.WorkerCreated, worker);\n    });\n    client.on('Target.detachedFromTarget', event => {\n      const worker = this._workers.get(event.sessionId);\n      if (!worker)\n        return;\n      this.emit(Events.Page.WorkerDestroyed, worker);\n      this._workers.delete(event.sessionId);\n    });\n\n    this._frameManager.on(Events.FrameManager.FrameAttached, event => this.emit(Events.Page.FrameAttached, event));\n    this._frameManager.on(Events.FrameManager.FrameDetached, event => this.emit(Events.Page.FrameDetached, event));\n    this._frameManager.on(Events.FrameManager.FrameNavigated, event => this.emit(Events.Page.FrameNavigated, event));\n\n    const networkManager = this._frameManager.networkManager();\n    networkManager.on(Events.NetworkManager.Request, event => this.emit(Events.Page.Request, event));\n    networkManager.on(Events.NetworkManager.Response, event => this.emit(Events.Page.Response, event));\n    networkManager.on(Events.NetworkManager.RequestFailed, event => this.emit(Events.Page.RequestFailed, event));\n    networkManager.on(Events.NetworkManager.RequestFinished, event => this.emit(Events.Page.RequestFinished, event));\n    this._fileChooserInterceptors = new Set();\n\n    client.on('Page.domContentEventFired', event => this.emit(Events.Page.DOMContentLoaded));\n    client.on('Page.loadEventFired', event => this.emit(Events.Page.Load));\n    client.on('Runtime.consoleAPICalled', event => this._onConsoleAPI(event));\n    client.on('Runtime.bindingCalled', event => this._onBindingCalled(event));\n    client.on('Page.javascriptDialogOpening', event => this._onDialog(event));\n    client.on('Runtime.exceptionThrown', exception => this._handleException(exception.exceptionDetails));\n    client.on('Inspector.targetCrashed', event => this._onTargetCrashed());\n    client.on('Performance.metrics', event => this._emitMetrics(event));\n    client.on('Log.entryAdded', event => this._onLogEntryAdded(event));\n    client.on('Page.fileChooserOpened', event => this._onFileChooser(event));\n    this._target._isClosedPromise.then(() => {\n      this.emit(Events.Page.Close);\n      this._closed = true;\n    });\n  }\n\n  async _initialize() {\n    await Promise.all([\n      this._frameManager.initialize(),\n      this._client.send('Target.setAutoAttach', {autoAttach: true, waitForDebuggerOnStart: false, flatten: true}),\n      this._client.send('Performance.enable', {}),\n      this._client.send('Log.enable', {}),\n    ]);\n  }\n\n  /**\n   * @param {!Protocol.Page.fileChooserOpenedPayload} event\n   */\n  async _onFileChooser(event) {\n    if (!this._fileChooserInterceptors.size)\n      return;\n    const frame = this._frameManager.frame(event.frameId);\n    const context = await frame.executionContext();\n    const element = await context._adoptBackendNodeId(event.backendNodeId);\n    const interceptors = Array.from(this._fileChooserInterceptors);\n    this._fileChooserInterceptors.clear();\n    const fileChooser = new FileChooser(this._client, element, event);\n    for (const interceptor of interceptors)\n      interceptor.call(null, fileChooser);\n  }\n\n  /**\n   * @param {!{timeout?: number}=} options\n   * @return !Promise<!FileChooser>}\n   */\n  async waitForFileChooser(options = {}) {\n    if (!this._fileChooserInterceptors.size)\n      await this._client.send('Page.setInterceptFileChooserDialog', {enabled: true});\n\n    const {\n      timeout = this._timeoutSettings.timeout(),\n    } = options;\n    let callback;\n    const promise = new Promise(x => callback = x);\n    this._fileChooserInterceptors.add(callback);\n    return helper.waitWithTimeout(promise, 'waiting for file chooser', timeout).catch(e => {\n      this._fileChooserInterceptors.delete(callback);\n      throw e;\n    });\n  }\n\n  /**\n   * @param {!{longitude: number, latitude: number, accuracy: (number|undefined)}} options\n   */\n  async setGeolocation(options) {\n    const { longitude, latitude, accuracy = 0} = options;\n    if (longitude < -180 || longitude > 180)\n      throw new Error(`Invalid longitude \"${longitude}\": precondition -180 <= LONGITUDE <= 180 failed.`);\n    if (latitude < -90 || latitude > 90)\n      throw new Error(`Invalid latitude \"${latitude}\": precondition -90 <= LATITUDE <= 90 failed.`);\n    if (accuracy < 0)\n      throw new Error(`Invalid accuracy \"${accuracy}\": precondition 0 <= ACCURACY failed.`);\n    await this._client.send('Emulation.setGeolocationOverride', {longitude, latitude, accuracy});\n  }\n\n  /**\n   * @return {!Puppeteer.Target}\n   */\n  target() {\n    return this._target;\n  }\n\n  /**\n   * @return {!Puppeteer.Browser}\n   */\n  browser() {\n    return this._target.browser();\n  }\n\n  /**\n   * @return {!Puppeteer.BrowserContext}\n   */\n  browserContext() {\n    return this._target.browserContext();\n  }\n\n  _onTargetCrashed() {\n    this.emit('error', new Error('Page crashed!'));\n  }\n\n  /**\n   * @param {!Protocol.Log.entryAddedPayload} event\n   */\n  _onLogEntryAdded(event) {\n    const {level, text, args, source, url, lineNumber} = event.entry;\n    if (args)\n      args.map(arg => helper.releaseObject(this._client, arg));\n    if (source !== 'worker')\n      this.emit(Events.Page.Console, new ConsoleMessage(level, text, [], {url, lineNumber}));\n  }\n\n  /**\n   * @return {!Puppeteer.Frame}\n   */\n  mainFrame() {\n    return this._frameManager.mainFrame();\n  }\n\n  /**\n   * @return {!Keyboard}\n   */\n  get keyboard() {\n    return this._keyboard;\n  }\n\n  /**\n   * @return {!Touchscreen}\n   */\n  get touchscreen() {\n    return this._touchscreen;\n  }\n\n  /**\n   * @return {!Coverage}\n   */\n  get coverage() {\n    return this._coverage;\n  }\n\n  /**\n   * @return {!Tracing}\n   */\n  get tracing() {\n    return this._tracing;\n  }\n\n  /**\n   * @return {!Accessibility}\n   */\n  get accessibility() {\n    return this._accessibility;\n  }\n\n  /**\n   * @return {!Array<Puppeteer.Frame>}\n   */\n  frames() {\n    return this._frameManager.frames();\n  }\n\n  /**\n   * @return {!Array<!Worker>}\n   */\n  workers() {\n    return Array.from(this._workers.values());\n  }\n\n  /**\n   * @param {boolean} value\n   */\n  async setRequestInterception(value) {\n    return this._frameManager.networkManager().setRequestInterception(value);\n  }\n\n  /**\n   * @param {boolean} enabled\n   */\n  setOfflineMode(enabled) {\n    return this._frameManager.networkManager().setOfflineMode(enabled);\n  }\n\n  /**\n   * @param {number} timeout\n   */\n  setDefaultNavigationTimeout(timeout) {\n    this._timeoutSettings.setDefaultNavigationTimeout(timeout);\n  }\n\n  /**\n   * @param {number} timeout\n   */\n  setDefaultTimeout(timeout) {\n    this._timeoutSettings.setDefaultTimeout(timeout);\n  }\n\n  /**\n   * @param {string} selector\n   * @return {!Promise<?Puppeteer.ElementHandle>}\n   */\n  async $(selector) {\n    return this.mainFrame().$(selector);\n  }\n\n  /**\n   * @param {Function|string} pageFunction\n   * @param {!Array<*>} args\n   * @return {!Promise<!Puppeteer.JSHandle>}\n   */\n  async evaluateHandle(pageFunction, ...args) {\n    const context = await this.mainFrame().executionContext();\n    return context.evaluateHandle(pageFunction, ...args);\n  }\n\n  /**\n   * @param {!Puppeteer.JSHandle} prototypeHandle\n   * @return {!Promise<!Puppeteer.JSHandle>}\n   */\n  async queryObjects(prototypeHandle) {\n    const context = await this.mainFrame().executionContext();\n    return context.queryObjects(prototypeHandle);\n  }\n\n  /**\n   * @param {string} selector\n   * @param {Function|string} pageFunction\n   * @param {!Array<*>} args\n   * @return {!Promise<(!Object|undefined)>}\n   */\n  async $eval(selector, pageFunction, ...args) {\n    return this.mainFrame().$eval(selector, pageFunction, ...args);\n  }\n\n  /**\n   * @param {string} selector\n   * @param {Function|string} pageFunction\n   * @param {!Array<*>} args\n   * @return {!Promise<(!Object|undefined)>}\n   */\n  async $$eval(selector, pageFunction, ...args) {\n    return this.mainFrame().$$eval(selector, pageFunction, ...args);\n  }\n\n  /**\n   * @param {string} selector\n   * @return {!Promise<!Array<!Puppeteer.ElementHandle>>}\n   */\n  async $$(selector) {\n    return this.mainFrame().$$(selector);\n  }\n\n  /**\n   * @param {string} expression\n   * @return {!Promise<!Array<!Puppeteer.ElementHandle>>}\n   */\n  async $x(expression) {\n    return this.mainFrame().$x(expression);\n  }\n\n  /**\n   * @param {!Array<string>} urls\n   * @return {!Promise<!Array<Network.Cookie>>}\n   */\n  async cookies(...urls) {\n    return (await this._client.send('Network.getCookies', {\n      urls: urls.length ? urls : [this.url()]\n    })).cookies;\n  }\n\n  /**\n   * @param {Array<Protocol.Network.deleteCookiesParameters>} cookies\n   */\n  async deleteCookie(...cookies) {\n    const pageURL = this.url();\n    for (const cookie of cookies) {\n      const item = Object.assign({}, cookie);\n      if (!cookie.url && pageURL.startsWith('http'))\n        item.url = pageURL;\n      await this._client.send('Network.deleteCookies', item);\n    }\n  }\n\n  /**\n   * @param {Array<Network.CookieParam>} cookies\n   */\n  async setCookie(...cookies) {\n    const pageURL = this.url();\n    const startsWithHTTP = pageURL.startsWith('http');\n    const items = cookies.map(cookie => {\n      const item = Object.assign({}, cookie);\n      if (!item.url && startsWithHTTP)\n        item.url = pageURL;\n      assert(item.url !== 'about:blank', `Blank page can not have cookie \"${item.name}\"`);\n      assert(!String.prototype.startsWith.call(item.url || '', 'data:'), `Data URL page can not have cookie \"${item.name}\"`);\n      return item;\n    });\n    await this.deleteCookie(...items);\n    if (items.length)\n      await this._client.send('Network.setCookies', { cookies: items });\n  }\n\n  /**\n   * @param {!{url?: string, path?: string, content?: string, type?: string}} options\n   * @return {!Promise<!Puppeteer.ElementHandle>}\n   */\n  async addScriptTag(options) {\n    return this.mainFrame().addScriptTag(options);\n  }\n\n  /**\n   * @param {!{url?: string, path?: string, content?: string}} options\n   * @return {!Promise<!Puppeteer.ElementHandle>}\n   */\n  async addStyleTag(options) {\n    return this.mainFrame().addStyleTag(options);\n  }\n\n  /**\n   * @param {string} name\n   * @param {Function} puppeteerFunction\n   */\n  async exposeFunction(name, puppeteerFunction) {\n    if (this._pageBindings.has(name))\n      throw new Error(`Failed to add page binding with name ${name}: window['${name}'] already exists!`);\n    this._pageBindings.set(name, puppeteerFunction);\n\n    const expression = helper.evaluationString(addPageBinding, name);\n    await this._client.send('Runtime.addBinding', {name: name});\n    await this._client.send('Page.addScriptToEvaluateOnNewDocument', {source: expression});\n    await Promise.all(this.frames().map(frame => frame.evaluate(expression).catch(debugError)));\n\n    function addPageBinding(bindingName) {\n      const binding = window[bindingName];\n      window[bindingName] = (...args) => {\n        const me = window[bindingName];\n        let callbacks = me['callbacks'];\n        if (!callbacks) {\n          callbacks = new Map();\n          me['callbacks'] = callbacks;\n        }\n        const seq = (me['lastSeq'] || 0) + 1;\n        me['lastSeq'] = seq;\n        const promise = new Promise((resolve, reject) => callbacks.set(seq, {resolve, reject}));\n        binding(JSON.stringify({name: bindingName, seq, args}));\n        return promise;\n      };\n    }\n  }\n\n  /**\n   * @param {?{username: string, password: string}} credentials\n   */\n  async authenticate(credentials) {\n    return this._frameManager.networkManager().authenticate(credentials);\n  }\n\n  /**\n   * @param {!Object<string, string>} headers\n   */\n  async setExtraHTTPHeaders(headers) {\n    return this._frameManager.networkManager().setExtraHTTPHeaders(headers);\n  }\n\n  /**\n   * @param {string} userAgent\n   */\n  async setUserAgent(userAgent) {\n    return this._frameManager.networkManager().setUserAgent(userAgent);\n  }\n\n  /**\n   * @return {!Promise<!Metrics>}\n   */\n  async metrics() {\n    const response = await this._client.send('Performance.getMetrics');\n    return this._buildMetricsObject(response.metrics);\n  }\n\n  /**\n   * @param {!Protocol.Performance.metricsPayload} event\n   */\n  _emitMetrics(event) {\n    this.emit(Events.Page.Metrics, {\n      title: event.title,\n      metrics: this._buildMetricsObject(event.metrics)\n    });\n  }\n\n  /**\n   * @param {?Array<!Protocol.Performance.Metric>} metrics\n   * @return {!Metrics}\n   */\n  _buildMetricsObject(metrics) {\n    const result = {};\n    for (const metric of metrics || []) {\n      if (supportedMetrics.has(metric.name))\n        result[metric.name] = metric.value;\n    }\n    return result;\n  }\n\n  /**\n   * @param {!Protocol.Runtime.ExceptionDetails} exceptionDetails\n   */\n  _handleException(exceptionDetails) {\n    const message = helper.getExceptionMessage(exceptionDetails);\n    const err = new Error(message);\n    err.stack = ''; // Don't report clientside error with a node stack attached\n    this.emit(Events.Page.PageError, err);\n  }\n\n  /**\n   * @param {!Protocol.Runtime.consoleAPICalledPayload} event\n   */\n  async _onConsoleAPI(event) {\n    if (event.executionContextId === 0) {\n      // DevTools protocol stores the last 1000 console messages. These\n      // messages are always reported even for removed execution contexts. In\n      // this case, they are marked with executionContextId = 0 and are\n      // reported upon enabling Runtime agent.\n      //\n      // Ignore these messages since:\n      // - there's no execution context we can use to operate with message\n      //   arguments\n      // - these messages are reported before Puppeteer clients can subscribe\n      //   to the 'console'\n      //   page event.\n      //\n      // @see https://github.com/puppeteer/puppeteer/issues/3865\n      return;\n    }\n    const context = this._frameManager.executionContextById(event.executionContextId);\n    const values = event.args.map(arg => createJSHandle(context, arg));\n    this._addConsoleMessage(event.type, values, event.stackTrace);\n  }\n\n  /**\n   * @param {!Protocol.Runtime.bindingCalledPayload} event\n   */\n  async _onBindingCalled(event) {\n    const {name, seq, args} = JSON.parse(event.payload);\n    let expression = null;\n    try {\n      const result = await this._pageBindings.get(name)(...args);\n      expression = helper.evaluationString(deliverResult, name, seq, result);\n    } catch (error) {\n      if (error instanceof Error)\n        expression = helper.evaluationString(deliverError, name, seq, error.message, error.stack);\n      else\n        expression = helper.evaluationString(deliverErrorValue, name, seq, error);\n    }\n    this._client.send('Runtime.evaluate', { expression, contextId: event.executionContextId }).catch(debugError);\n\n    /**\n     * @param {string} name\n     * @param {number} seq\n     * @param {*} result\n     */\n    function deliverResult(name, seq, result) {\n      window[name]['callbacks'].get(seq).resolve(result);\n      window[name]['callbacks'].delete(seq);\n    }\n\n    /**\n     * @param {string} name\n     * @param {number} seq\n     * @param {string} message\n     * @param {string} stack\n     */\n    function deliverError(name, seq, message, stack) {\n      const error = new Error(message);\n      error.stack = stack;\n      window[name]['callbacks'].get(seq).reject(error);\n      window[name]['callbacks'].delete(seq);\n    }\n\n    /**\n     * @param {string} name\n     * @param {number} seq\n     * @param {*} value\n     */\n    function deliverErrorValue(name, seq, value) {\n      window[name]['callbacks'].get(seq).reject(value);\n      window[name]['callbacks'].delete(seq);\n    }\n  }\n\n  /**\n   * @param {string} type\n   * @param {!Array<!Puppeteer.JSHandle>} args\n   * @param {Protocol.Runtime.StackTrace=} stackTrace\n   */\n  _addConsoleMessage(type, args, stackTrace) {\n    if (!this.listenerCount(Events.Page.Console)) {\n      args.forEach(arg => arg.dispose());\n      return;\n    }\n    const textTokens = [];\n    for (const arg of args) {\n      const remoteObject = arg._remoteObject;\n      if (remoteObject.objectId)\n        textTokens.push(arg.toString());\n      else\n        textTokens.push(helper.valueFromRemoteObject(remoteObject));\n    }\n    const location = stackTrace && stackTrace.callFrames.length ? {\n      url: stackTrace.callFrames[0].url,\n      lineNumber: stackTrace.callFrames[0].lineNumber,\n      columnNumber: stackTrace.callFrames[0].columnNumber,\n    } : {};\n    const message = new ConsoleMessage(type, textTokens.join(' '), args, location);\n    this.emit(Events.Page.Console, message);\n  }\n\n  _onDialog(event) {\n    let dialogType = null;\n    if (event.type === 'alert')\n      dialogType = Dialog.Type.Alert;\n    else if (event.type === 'confirm')\n      dialogType = Dialog.Type.Confirm;\n    else if (event.type === 'prompt')\n      dialogType = Dialog.Type.Prompt;\n    else if (event.type === 'beforeunload')\n      dialogType = Dialog.Type.BeforeUnload;\n    assert(dialogType, 'Unknown javascript dialog type: ' + event.type);\n    const dialog = new Dialog(this._client, dialogType, event.message, event.defaultPrompt);\n    this.emit(Events.Page.Dialog, dialog);\n  }\n\n  /**\n   * @return {!string}\n   */\n  url() {\n    return this.mainFrame().url();\n  }\n\n  /**\n   * @return {!Promise<string>}\n   */\n  async content() {\n    return await this._frameManager.mainFrame().content();\n  }\n\n  /**\n   * @param {string} html\n   * @param {!{timeout?: number, waitUntil?: string|!Array<string>}=} options\n   */\n  async setContent(html, options) {\n    await this._frameManager.mainFrame().setContent(html, options);\n  }\n\n  /**\n   * @param {string} url\n   * @param {!{referer?: string, timeout?: number, waitUntil?: string|!Array<string>}=} options\n   * @return {!Promise<?Puppeteer.Response>}\n   */\n  async goto(url, options) {\n    return await this._frameManager.mainFrame().goto(url, options);\n  }\n\n  /**\n   * @param {!{timeout?: number, waitUntil?: string|!Array<string>}=} options\n   * @return {!Promise<?Puppeteer.Response>}\n   */\n  async reload(options) {\n    const [response] = await Promise.all([\n      this.waitForNavigation(options),\n      this._client.send('Page.reload')\n    ]);\n    return response;\n  }\n\n  /**\n   * @param {!{timeout?: number, waitUntil?: string|!Array<string>}=} options\n   * @return {!Promise<?Puppeteer.Response>}\n   */\n  async waitForNavigation(options = {}) {\n    return await this._frameManager.mainFrame().waitForNavigation(options);\n  }\n\n  _sessionClosePromise() {\n    if (!this._disconnectPromise)\n      this._disconnectPromise = new Promise(fulfill => this._client.once(Events.CDPSession.Disconnected, () => fulfill(new Error('Target closed'))));\n    return this._disconnectPromise;\n  }\n\n  /**\n   * @param {(string|Function)} urlOrPredicate\n   * @param {!{timeout?: number}=} options\n   * @return {!Promise<!Puppeteer.Request>}\n   */\n  async waitForRequest(urlOrPredicate, options = {}) {\n    const {\n      timeout = this._timeoutSettings.timeout(),\n    } = options;\n    return helper.waitForEvent(this._frameManager.networkManager(), Events.NetworkManager.Request, request => {\n      if (helper.isString(urlOrPredicate))\n        return (urlOrPredicate === request.url());\n      if (typeof urlOrPredicate === 'function')\n        return !!(urlOrPredicate(request));\n      return false;\n    }, timeout, this._sessionClosePromise());\n  }\n\n  /**\n   * @param {(string|Function)} urlOrPredicate\n   * @param {!{timeout?: number}=} options\n   * @return {!Promise<!Puppeteer.Response>}\n   */\n  async waitForResponse(urlOrPredicate, options = {}) {\n    const {\n      timeout = this._timeoutSettings.timeout(),\n    } = options;\n    return helper.waitForEvent(this._frameManager.networkManager(), Events.NetworkManager.Response, response => {\n      if (helper.isString(urlOrPredicate))\n        return (urlOrPredicate === response.url());\n      if (typeof urlOrPredicate === 'function')\n        return !!(urlOrPredicate(response));\n      return false;\n    }, timeout, this._sessionClosePromise());\n  }\n\n  /**\n   * @param {!{timeout?: number, waitUntil?: string|!Array<string>}=} options\n   * @return {!Promise<?Puppeteer.Response>}\n   */\n  async goBack(options) {\n    return this._go(-1, options);\n  }\n\n  /**\n   * @param {!{timeout?: number, waitUntil?: string|!Array<string>}=} options\n   * @return {!Promise<?Puppeteer.Response>}\n   */\n  async goForward(options) {\n    return this._go(+1, options);\n  }\n\n  /**\n   * @param {!{timeout?: number, waitUntil?: string|!Array<string>}=} options\n   * @return {!Promise<?Puppeteer.Response>}\n   */\n  async _go(delta, options) {\n    const history = await this._client.send('Page.getNavigationHistory');\n    const entry = history.entries[history.currentIndex + delta];\n    if (!entry)\n      return null;\n    const [response] = await Promise.all([\n      this.waitForNavigation(options),\n      this._client.send('Page.navigateToHistoryEntry', {entryId: entry.id}),\n    ]);\n    return response;\n  }\n\n  async bringToFront() {\n    await this._client.send('Page.bringToFront');\n  }\n\n  /**\n   * @param {!{viewport: !Puppeteer.Viewport, userAgent: string}} options\n   */\n  async emulate(options) {\n    await Promise.all([\n      this.setViewport(options.viewport),\n      this.setUserAgent(options.userAgent)\n    ]);\n  }\n\n  /**\n   * @param {boolean} enabled\n   */\n  async setJavaScriptEnabled(enabled) {\n    if (this._javascriptEnabled === enabled)\n      return;\n    this._javascriptEnabled = enabled;\n    await this._client.send('Emulation.setScriptExecutionDisabled', { value: !enabled });\n  }\n\n  /**\n   * @param {boolean} enabled\n   */\n  async setBypassCSP(enabled) {\n    await this._client.send('Page.setBypassCSP', { enabled });\n  }\n\n  /**\n   * @param {?string} type\n   */\n  async emulateMediaType(type) {\n    assert(type === 'screen' || type === 'print' || type === null, 'Unsupported media type: ' + type);\n    await this._client.send('Emulation.setEmulatedMedia', {media: type || ''});\n  }\n\n  /**\n   * @param {?Array<MediaFeature>} features\n   */\n  async emulateMediaFeatures(features) {\n    if (features === null)\n      await this._client.send('Emulation.setEmulatedMedia', {features: null});\n    if (Array.isArray(features)) {\n      features.every(mediaFeature => {\n        const name = mediaFeature.name;\n        assert(/^prefers-(?:color-scheme|reduced-motion)$/.test(name), 'Unsupported media feature: ' + name);\n        return true;\n      });\n      await this._client.send('Emulation.setEmulatedMedia', {features: features});\n    }\n  }\n\n  /**\n   * @param {?string} timezoneId\n   */\n  async emulateTimezone(timezoneId) {\n    try {\n      await this._client.send('Emulation.setTimezoneOverride', {timezoneId: timezoneId || ''});\n    } catch (exception) {\n      if (exception.message.includes('Invalid timezone'))\n        throw new Error(`Invalid timezone ID: ${timezoneId}`);\n      throw exception;\n    }\n  }\n\n  /**\n   * @param {!Puppeteer.Viewport} viewport\n   */\n  async setViewport(viewport) {\n    const needsReload = await this._emulationManager.emulateViewport(viewport);\n    this._viewport = viewport;\n    if (needsReload)\n      await this.reload();\n  }\n\n  /**\n   * @return {?Puppeteer.Viewport}\n   */\n  viewport() {\n    return this._viewport;\n  }\n\n  /**\n   * @param {Function|string} pageFunction\n   * @param {!Array<*>} args\n   * @return {!Promise<*>}\n   */\n  async evaluate(pageFunction, ...args) {\n    return this._frameManager.mainFrame().evaluate(pageFunction, ...args);\n  }\n\n  /**\n   * @param {Function|string} pageFunction\n   * @param {!Array<*>} args\n   */\n  async evaluateOnNewDocument(pageFunction, ...args) {\n    const source = helper.evaluationString(pageFunction, ...args);\n    await this._client.send('Page.addScriptToEvaluateOnNewDocument', { source });\n  }\n\n  /**\n   * @param {boolean} enabled\n   */\n  async setCacheEnabled(enabled = true) {\n    await this._frameManager.networkManager().setCacheEnabled(enabled);\n  }\n\n  /**\n   * @param {!ScreenshotOptions=} options\n   * @return {!Promise<!Buffer|!String>}\n   */\n  async screenshot(options = {}) {\n    let screenshotType = null;\n    // options.type takes precedence over inferring the type from options.path\n    // because it may be a 0-length file with no extension created beforehand (i.e. as a temp file).\n    if (options.type) {\n      assert(options.type === 'png' || options.type === 'jpeg', 'Unknown options.type value: ' + options.type);\n      screenshotType = options.type;\n    } else if (options.path) {\n      const mimeType = mime.getType(options.path);\n      if (mimeType === 'image/png')\n        screenshotType = 'png';\n      else if (mimeType === 'image/jpeg')\n        screenshotType = 'jpeg';\n      assert(screenshotType, 'Unsupported screenshot mime type: ' + mimeType);\n    }\n\n    if (!screenshotType)\n      screenshotType = 'png';\n\n    if (options.quality) {\n      assert(screenshotType === 'jpeg', 'options.quality is unsupported for the ' + screenshotType + ' screenshots');\n      assert(typeof options.quality === 'number', 'Expected options.quality to be a number but found ' + (typeof options.quality));\n      assert(Number.isInteger(options.quality), 'Expected options.quality to be an integer');\n      assert(options.quality >= 0 && options.quality <= 100, 'Expected options.quality to be between 0 and 100 (inclusive), got ' + options.quality);\n    }\n    assert(!options.clip || !options.fullPage, 'options.clip and options.fullPage are exclusive');\n    if (options.clip) {\n      assert(typeof options.clip.x === 'number', 'Expected options.clip.x to be a number but found ' + (typeof options.clip.x));\n      assert(typeof options.clip.y === 'number', 'Expected options.clip.y to be a number but found ' + (typeof options.clip.y));\n      assert(typeof options.clip.width === 'number', 'Expected options.clip.width to be a number but found ' + (typeof options.clip.width));\n      assert(typeof options.clip.height === 'number', 'Expected options.clip.height to be a number but found ' + (typeof options.clip.height));\n      assert(options.clip.width !== 0, 'Expected options.clip.width not to be 0.');\n      assert(options.clip.height !== 0, 'Expected options.clip.height not to be 0.');\n    }\n    return this._screenshotTaskQueue.postTask(this._screenshotTask.bind(this, screenshotType, options));\n  }\n\n  /**\n   * @param {\"png\"|\"jpeg\"} format\n   * @param {!ScreenshotOptions=} options\n   * @return {!Promise<!Buffer|!String>}\n   */\n  async _screenshotTask(format, options) {\n    await this._client.send('Target.activateTarget', {targetId: this._target._targetId});\n    let clip = options.clip ? processClip(options.clip) : undefined;\n\n    if (options.fullPage) {\n      const metrics = await this._client.send('Page.getLayoutMetrics');\n      const width = Math.ceil(metrics.contentSize.width);\n      const height = Math.ceil(metrics.contentSize.height);\n\n      // Overwrite clip for full page at all times.\n      clip = { x: 0, y: 0, width, height, scale: 1 };\n      const {\n        isMobile = false,\n        deviceScaleFactor = 1,\n        isLandscape = false\n      } = this._viewport || {};\n      /** @type {!Protocol.Emulation.ScreenOrientation} */\n      const screenOrientation = isLandscape ? { angle: 90, type: 'landscapePrimary' } : { angle: 0, type: 'portraitPrimary' };\n      await this._client.send('Emulation.setDeviceMetricsOverride', { mobile: isMobile, width, height, deviceScaleFactor, screenOrientation });\n    }\n    const shouldSetDefaultBackground = options.omitBackground && format === 'png';\n    if (shouldSetDefaultBackground)\n      await this._client.send('Emulation.setDefaultBackgroundColorOverride', { color: { r: 0, g: 0, b: 0, a: 0 } });\n    const result = await this._client.send('Page.captureScreenshot', { format, quality: options.quality, clip });\n    if (shouldSetDefaultBackground)\n      await this._client.send('Emulation.setDefaultBackgroundColorOverride');\n\n    if (options.fullPage && this._viewport)\n      await this.setViewport(this._viewport);\n\n    const buffer = options.encoding === 'base64' ? result.data : Buffer.from(result.data, 'base64');\n    if (options.path)\n      await writeFileAsync(options.path, buffer);\n    return buffer;\n\n    function processClip(clip) {\n      const x = Math.round(clip.x);\n      const y = Math.round(clip.y);\n      const width = Math.round(clip.width + clip.x - x);\n      const height = Math.round(clip.height + clip.y - y);\n      return {x, y, width, height, scale: 1};\n    }\n  }\n\n  /**\n   * @param {!PDFOptions=} options\n   * @return {!Promise<!Buffer>}\n   */\n  async pdf(options = {}) {\n    const {\n      scale = 1,\n      displayHeaderFooter = false,\n      headerTemplate = '',\n      footerTemplate = '',\n      printBackground = false,\n      landscape = false,\n      pageRanges = '',\n      preferCSSPageSize = false,\n      margin = {},\n      path = null\n    } = options;\n\n    let paperWidth = 8.5;\n    let paperHeight = 11;\n    if (options.format) {\n      const format = Page.PaperFormats[options.format.toLowerCase()];\n      assert(format, 'Unknown paper format: ' + options.format);\n      paperWidth = format.width;\n      paperHeight = format.height;\n    } else {\n      paperWidth = convertPrintParameterToInches(options.width) || paperWidth;\n      paperHeight = convertPrintParameterToInches(options.height) || paperHeight;\n    }\n\n    const marginTop = convertPrintParameterToInches(margin.top) || 0;\n    const marginLeft = convertPrintParameterToInches(margin.left) || 0;\n    const marginBottom = convertPrintParameterToInches(margin.bottom) || 0;\n    const marginRight = convertPrintParameterToInches(margin.right) || 0;\n\n    const result = await this._client.send('Page.printToPDF', {\n      transferMode: 'ReturnAsStream',\n      landscape,\n      displayHeaderFooter,\n      headerTemplate,\n      footerTemplate,\n      printBackground,\n      scale,\n      paperWidth,\n      paperHeight,\n      marginTop,\n      marginBottom,\n      marginLeft,\n      marginRight,\n      pageRanges,\n      preferCSSPageSize\n    });\n    return await helper.readProtocolStream(this._client, result.stream, path);\n  }\n\n  /**\n   * @return {!Promise<string>}\n   */\n  async title() {\n    return this.mainFrame().title();\n  }\n\n  /**\n   * @param {!{runBeforeUnload: (boolean|undefined)}=} options\n   */\n  async close(options = {runBeforeUnload: undefined}) {\n    assert(!!this._client._connection, 'Protocol error: Connection closed. Most likely the page has been closed.');\n    const runBeforeUnload = !!options.runBeforeUnload;\n    if (runBeforeUnload) {\n      await this._client.send('Page.close');\n    } else {\n      await this._client._connection.send('Target.closeTarget', { targetId: this._target._targetId });\n      await this._target._isClosedPromise;\n    }\n  }\n\n  /**\n   * @return {boolean}\n   */\n  isClosed() {\n    return this._closed;\n  }\n\n  /**\n   * @return {!Mouse}\n   */\n  get mouse() {\n    return this._mouse;\n  }\n\n  /**\n   * @param {string} selector\n   * @param {!{delay?: number, button?: \"left\"|\"right\"|\"middle\", clickCount?: number}=} options\n   */\n  click(selector, options = {}) {\n    return this.mainFrame().click(selector, options);\n  }\n\n  /**\n   * @param {string} selector\n   */\n  focus(selector) {\n    return this.mainFrame().focus(selector);\n  }\n\n  /**\n   * @param {string} selector\n   */\n  hover(selector) {\n    return this.mainFrame().hover(selector);\n  }\n\n  /**\n   * @param {string} selector\n   * @param {!Array<string>} values\n   * @return {!Promise<!Array<string>>}\n   */\n  select(selector, ...values) {\n    return this.mainFrame().select(selector, ...values);\n  }\n\n  /**\n   * @param {string} selector\n   */\n  tap(selector) {\n    return this.mainFrame().tap(selector);\n  }\n\n  /**\n   * @param {string} selector\n   * @param {string} text\n   * @param {{delay: (number|undefined)}=} options\n   */\n  type(selector, text, options) {\n    return this.mainFrame().type(selector, text, options);\n  }\n\n  /**\n   * @param {(string|number|Function)} selectorOrFunctionOrTimeout\n   * @param {!{visible?: boolean, hidden?: boolean, timeout?: number, polling?: string|number}=} options\n   * @param {!Array<*>} args\n   * @return {!Promise<!Puppeteer.JSHandle>}\n   */\n  waitFor(selectorOrFunctionOrTimeout, options = {}, ...args) {\n    return this.mainFrame().waitFor(selectorOrFunctionOrTimeout, options, ...args);\n  }\n\n  /**\n   * @param {string} selector\n   * @param {!{visible?: boolean, hidden?: boolean, timeout?: number}=} options\n   * @return {!Promise<?Puppeteer.ElementHandle>}\n   */\n  waitForSelector(selector, options = {}) {\n    return this.mainFrame().waitForSelector(selector, options);\n  }\n\n  /**\n   * @param {string} xpath\n   * @param {!{visible?: boolean, hidden?: boolean, timeout?: number}=} options\n   * @return {!Promise<?Puppeteer.ElementHandle>}\n   */\n  waitForXPath(xpath, options = {}) {\n    return this.mainFrame().waitForXPath(xpath, options);\n  }\n\n  /**\n   * @param {Function} pageFunction\n   * @param {!{polling?: string|number, timeout?: number}=} options\n   * @param {!Array<*>} args\n   * @return {!Promise<!Puppeteer.JSHandle>}\n   */\n  waitForFunction(pageFunction, options = {}, ...args) {\n    return this.mainFrame().waitForFunction(pageFunction, options, ...args);\n  }\n}\n\n// Expose alias for deprecated method.\nPage.prototype.emulateMedia = Page.prototype.emulateMediaType;\n\n/**\n * @typedef {Object} PDFOptions\n * @property {number=} scale\n * @property {boolean=} displayHeaderFooter\n * @property {string=} headerTemplate\n * @property {string=} footerTemplate\n * @property {boolean=} printBackground\n * @property {boolean=} landscape\n * @property {string=} pageRanges\n * @property {string=} format\n * @property {string|number=} width\n * @property {string|number=} height\n * @property {boolean=} preferCSSPageSize\n * @property {!{top?: string|number, bottom?: string|number, left?: string|number, right?: string|number}=} margin\n * @property {string=} path\n */\n\n/**\n * @typedef {Object} Metrics\n * @property {number=} Timestamp\n * @property {number=} Documents\n * @property {number=} Frames\n * @property {number=} JSEventListeners\n * @property {number=} Nodes\n * @property {number=} LayoutCount\n * @property {number=} RecalcStyleCount\n * @property {number=} LayoutDuration\n * @property {number=} RecalcStyleDuration\n * @property {number=} ScriptDuration\n * @property {number=} TaskDuration\n * @property {number=} JSHeapUsedSize\n * @property {number=} JSHeapTotalSize\n */\n\n/**\n * @typedef {Object} ScreenshotOptions\n * @property {string=} type\n * @property {string=} path\n * @property {boolean=} fullPage\n * @property {{x: number, y: number, width: number, height: number}=} clip\n * @property {number=} quality\n * @property {boolean=} omitBackground\n * @property {string=} encoding\n */\n\n/**\n * @typedef {Object} MediaFeature\n * @property {string} name\n * @property {string} value\n */\n\n/** @type {!Set<string>} */\nconst supportedMetrics = new Set([\n  'Timestamp',\n  'Documents',\n  'Frames',\n  'JSEventListeners',\n  'Nodes',\n  'LayoutCount',\n  'RecalcStyleCount',\n  'LayoutDuration',\n  'RecalcStyleDuration',\n  'ScriptDuration',\n  'TaskDuration',\n  'JSHeapUsedSize',\n  'JSHeapTotalSize',\n]);\n\n/** @enum {!{width: number, height: number}} */\nPage.PaperFormats = {\n  letter: {width: 8.5, height: 11},\n  legal: {width: 8.5, height: 14},\n  tabloid: {width: 11, height: 17},\n  ledger: {width: 17, height: 11},\n  a0: {width: 33.1, height: 46.8 },\n  a1: {width: 23.4, height: 33.1 },\n  a2: {width: 16.54, height: 23.4 },\n  a3: {width: 11.7, height: 16.54 },\n  a4: {width: 8.27, height: 11.7 },\n  a5: {width: 5.83, height: 8.27 },\n  a6: {width: 4.13, height: 5.83 },\n};\n\nconst unitToPixels = {\n  'px': 1,\n  'in': 96,\n  'cm': 37.8,\n  'mm': 3.78\n};\n\n/**\n * @param {(string|number|undefined)} parameter\n * @return {(number|undefined)}\n */\nfunction convertPrintParameterToInches(parameter) {\n  if (typeof parameter === 'undefined')\n    return undefined;\n  let pixels;\n  if (helper.isNumber(parameter)) {\n    // Treat numbers as pixel values to be aligned with phantom's paperSize.\n    pixels = /** @type {number} */ (parameter);\n  } else if (helper.isString(parameter)) {\n    const text = /** @type {string} */ (parameter);\n    let unit = text.substring(text.length - 2).toLowerCase();\n    let valueText = '';\n    if (unitToPixels.hasOwnProperty(unit)) {\n      valueText = text.substring(0, text.length - 2);\n    } else {\n      // In case of unknown unit try to parse the whole parameter as number of pixels.\n      // This is consistent with phantom's paperSize behavior.\n      unit = 'px';\n      valueText = text;\n    }\n    const value = Number(valueText);\n    assert(!isNaN(value), 'Failed to parse parameter value: ' + text);\n    pixels = value * unitToPixels[unit];\n  } else {\n    throw new Error('page.pdf() Cannot handle parameter type: ' + (typeof parameter));\n  }\n  return pixels / 96;\n}\n\n/**\n * @typedef {Object} Network.Cookie\n * @property {string} name\n * @property {string} value\n * @property {string} domain\n * @property {string} path\n * @property {number} expires\n * @property {number} size\n * @property {boolean} httpOnly\n * @property {boolean} secure\n * @property {boolean} session\n * @property {(\"Strict\"|\"Lax\"|\"Extended\"|\"None\")=} sameSite\n */\n\n\n/**\n * @typedef {Object} Network.CookieParam\n * @property {string} name\n * @property {string} value\n * @property {string=} url\n * @property {string=} domain\n * @property {string=} path\n * @property {number=} expires\n * @property {boolean=} httpOnly\n * @property {boolean=} secure\n * @property {(\"Strict\"|\"Lax\")=} sameSite\n */\n\n/**\n * @typedef {Object} ConsoleMessage.Location\n * @property {string=} url\n * @property {number=} lineNumber\n * @property {number=} columnNumber\n */\n\nclass ConsoleMessage {\n  /**\n   * @param {string} type\n   * @param {string} text\n   * @param {!Array<!Puppeteer.JSHandle>} args\n   * @param {ConsoleMessage.Location} location\n   */\n  constructor(type, text, args, location = {}) {\n    this._type = type;\n    this._text = text;\n    this._args = args;\n    this._location = location;\n  }\n\n  /**\n   * @return {string}\n   */\n  type() {\n    return this._type;\n  }\n\n  /**\n   * @return {string}\n   */\n  text() {\n    return this._text;\n  }\n\n  /**\n   * @return {!Array<!Puppeteer.JSHandle>}\n   */\n  args() {\n    return this._args;\n  }\n\n  /**\n   * @return {Object}\n   */\n  location() {\n    return this._location;\n  }\n}\n\nclass FileChooser {\n  /**\n   * @param {Puppeteer.CDPSession} client\n   * @param {Puppeteer.ElementHandle} element\n   * @param {!Protocol.Page.fileChooserOpenedPayload} event\n   */\n  constructor(client, element, event) {\n    this._client = client;\n    this._element = element;\n    this._multiple = event.mode !== 'selectSingle';\n    this._handled = false;\n  }\n\n  /**\n   * @return {boolean}\n   */\n  isMultiple() {\n    return this._multiple;\n  }\n\n  /**\n   * @param {!Array<string>} filePaths\n   * @return {!Promise}\n   */\n  async accept(filePaths) {\n    assert(!this._handled, 'Cannot accept FileChooser which is already handled!');\n    this._handled = true;\n    await this._element.uploadFile(...filePaths);\n  }\n\n  /**\n   * @return {!Promise}\n   */\n  async cancel() {\n    assert(!this._handled, 'Cannot cancel FileChooser which is already handled!');\n    this._handled = true;\n  }\n}\n\nmodule.exports = {Page, ConsoleMessage, FileChooser};\n"]},"metadata":{},"sourceType":"script"}